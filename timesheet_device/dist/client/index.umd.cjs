(function(ae,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],u):(ae=typeof globalThis<"u"?globalThis:ae||self,u(ae.TimesheetDeviceUI={},ae.React))})(this,function(ae,u){"use strict";var ze={exports:{}},Se={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ct;function _t(){if(ct)return Se;ct=1;var l=u,f=Symbol.for("react.element"),v=Symbol.for("react.fragment"),m=Object.prototype.hasOwnProperty,E=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,D={key:!0,ref:!0,__self:!0,__source:!0};function y(x,w,A){var C,P={},K=null,Y=null;A!==void 0&&(K=""+A),w.key!==void 0&&(K=""+w.key),w.ref!==void 0&&(Y=w.ref);for(C in w)m.call(w,C)&&!D.hasOwnProperty(C)&&(P[C]=w[C]);if(x&&x.defaultProps)for(C in w=x.defaultProps,w)P[C]===void 0&&(P[C]=w[C]);return{$$typeof:f,type:x,key:K,ref:Y,props:P,_owner:E.current}}return Se.Fragment=v,Se.jsx=y,Se.jsxs=y,Se}var _e={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ut;function Tt(){return ut||(ut=1,process.env.NODE_ENV!=="production"&&function(){var l=u,f=Symbol.for("react.element"),v=Symbol.for("react.portal"),m=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),y=Symbol.for("react.provider"),x=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),Y=Symbol.for("react.offscreen"),xe=Symbol.iterator,Ye="@@iterator";function X(e){if(e===null||typeof e!="object")return null;var n=xe&&e[xe]||e[Ye];return typeof n=="function"?n:null}var ne=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function O(e){{for(var n=arguments.length,i=new Array(n>1?n-1:0),p=1;p<n;p++)i[p-1]=arguments[p];et("error",e,i)}}function et(e,n,i){{var p=ne.ReactDebugCurrentFrame,S=p.getStackAddendum();S!==""&&(n+="%s",i=i.concat([S]));var T=i.map(function(b){return String(b)});T.unshift("Warning: "+n),Function.prototype.apply.call(console[e],console,T)}}var ue=!1,tt=!1,Ue=!1,je=!1,de=!1,Ne;Ne=Symbol.for("react.module.reference");function Ce(e){return!!(typeof e=="string"||typeof e=="function"||e===m||e===D||de||e===E||e===A||e===C||je||e===Y||ue||tt||Ue||typeof e=="object"&&e!==null&&(e.$$typeof===K||e.$$typeof===P||e.$$typeof===y||e.$$typeof===x||e.$$typeof===w||e.$$typeof===Ne||e.getModuleId!==void 0))}function se(e,n,i){var p=e.displayName;if(p)return p;var S=n.displayName||n.name||"";return S!==""?i+"("+S+")":i}function V(e){return e.displayName||"Context"}function B(e){if(e==null)return null;if(typeof e.tag=="number"&&O("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case m:return"Fragment";case v:return"Portal";case D:return"Profiler";case E:return"StrictMode";case A:return"Suspense";case C:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case x:var n=e;return V(n)+".Consumer";case y:var i=e;return V(i._context)+".Provider";case w:return se(e,e.render,"ForwardRef");case P:var p=e.displayName||null;return p!==null?p:B(e.type)||"Memo";case K:{var S=e,T=S._payload,b=S._init;try{return B(b(T))}catch{return null}}}return null}var J=Object.assign,Q=0,re,Z,G,Le,Ve,H,De;function oe(){}oe.__reactDisabledLog=!0;function Oe(){{if(Q===0){re=console.log,Z=console.info,G=console.warn,Le=console.error,Ve=console.group,H=console.groupCollapsed,De=console.groupEnd;var e={configurable:!0,enumerable:!0,value:oe,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}Q++}}function ke(){{if(Q--,Q===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:J({},e,{value:re}),info:J({},e,{value:Z}),warn:J({},e,{value:G}),error:J({},e,{value:Le}),group:J({},e,{value:Ve}),groupCollapsed:J({},e,{value:H}),groupEnd:J({},e,{value:De})})}Q<0&&O("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var fe=ne.ReactCurrentDispatcher,me;function $(e,n,i){{if(me===void 0)try{throw Error()}catch(S){var p=S.stack.trim().match(/\n( *(at )?)/);me=p&&p[1]||""}return`
`+me+e}}var pe=!1,M;{var Ae=typeof WeakMap=="function"?WeakMap:Map;M=new Ae}function Pe(e,n){if(!e||pe)return"";{var i=M.get(e);if(i!==void 0)return i}var p;pe=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var T;T=fe.current,fe.current=null,Oe();try{if(n){var b=function(){throw Error()};if(Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(U){p=U}Reflect.construct(e,[],b)}else{try{b.call()}catch(U){p=U}e.call(b.prototype)}}else{try{throw Error()}catch(U){p=U}e()}}catch(U){if(U&&p&&typeof U.stack=="string"){for(var g=U.stack.split(`
`),F=p.stack.split(`
`),L=g.length-1,k=F.length-1;L>=1&&k>=0&&g[L]!==F[k];)k--;for(;L>=1&&k>=0;L--,k--)if(g[L]!==F[k]){if(L!==1||k!==1)do if(L--,k--,k<0||g[L]!==F[k]){var W=`
`+g[L].replace(" at new "," at ");return e.displayName&&W.includes("<anonymous>")&&(W=W.replace("<anonymous>",e.displayName)),typeof e=="function"&&M.set(e,W),W}while(L>=1&&k>=0);break}}}finally{pe=!1,fe.current=T,ke(),Error.prepareStackTrace=S}var Ee=e?e.displayName||e.name:"",ie=Ee?$(Ee):"";return typeof e=="function"&&M.set(e,ie),ie}function he(e,n,i){return Pe(e,!1)}function ve(e){var n=e.prototype;return!!(n&&n.isReactComponent)}function ee(e,n,i){if(e==null)return"";if(typeof e=="function")return Pe(e,ve(e));if(typeof e=="string")return $(e);switch(e){case A:return $("Suspense");case C:return $("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case w:return he(e.render);case P:return ee(e.type,n,i);case K:{var p=e,S=p._payload,T=p._init;try{return ee(T(S),n,i)}catch{}}}return""}var te=Object.prototype.hasOwnProperty,Be={},We=ne.ReactDebugCurrentFrame;function ge(e){if(e){var n=e._owner,i=ee(e.type,e._source,n?n.type:null);We.setExtraStackFrame(i)}else We.setExtraStackFrame(null)}function nt(e,n,i,p,S){{var T=Function.call.bind(te);for(var b in e)if(T(e,b)){var g=void 0;try{if(typeof e[b]!="function"){var F=Error((p||"React class")+": "+i+" type `"+b+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[b]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw F.name="Invariant Violation",F}g=e[b](n,b,p,i,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(L){g=L}g&&!(g instanceof Error)&&(ge(S),O("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",p||"React class",i,b,typeof g),ge(null)),g instanceof Error&&!(g.message in Be)&&(Be[g.message]=!0,ge(S),O("Failed %s type: %s",i,g.message),ge(null))}}}var rt=Array.isArray;function Me(e){return rt(e)}function at(e){{var n=typeof Symbol=="function"&&Symbol.toStringTag,i=n&&e[Symbol.toStringTag]||e.constructor.name||"Object";return i}}function st(e){try{return Je(e),!1}catch{return!0}}function Je(e){return""+e}function be(e){if(st(e))return O("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",at(e)),Je(e)}var Ge=ne.ReactCurrentOwner,ot={key:!0,ref:!0,__self:!0,__source:!0},z,He;function ye(e){if(te.call(e,"ref")){var n=Object.getOwnPropertyDescriptor(e,"ref").get;if(n&&n.isReactWarning)return!1}return e.ref!==void 0}function t(e){if(te.call(e,"key")){var n=Object.getOwnPropertyDescriptor(e,"key").get;if(n&&n.isReactWarning)return!1}return e.key!==void 0}function r(e,n){typeof e.ref=="string"&&Ge.current}function a(e,n){{var i=function(){z||(z=!0,O("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",n))};i.isReactWarning=!0,Object.defineProperty(e,"key",{get:i,configurable:!0})}}function o(e,n){{var i=function(){He||(He=!0,O("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",n))};i.isReactWarning=!0,Object.defineProperty(e,"ref",{get:i,configurable:!0})}}var c=function(e,n,i,p,S,T,b){var g={$$typeof:f,type:e,key:n,ref:i,props:b,_owner:T};return g._store={},Object.defineProperty(g._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(g,"_self",{configurable:!1,enumerable:!1,writable:!1,value:p}),Object.defineProperty(g,"_source",{configurable:!1,enumerable:!1,writable:!1,value:S}),Object.freeze&&(Object.freeze(g.props),Object.freeze(g)),g};function s(e,n,i,p,S){{var T,b={},g=null,F=null;i!==void 0&&(be(i),g=""+i),t(n)&&(be(n.key),g=""+n.key),ye(n)&&(F=n.ref,r(n,S));for(T in n)te.call(n,T)&&!ot.hasOwnProperty(T)&&(b[T]=n[T]);if(e&&e.defaultProps){var L=e.defaultProps;for(T in L)b[T]===void 0&&(b[T]=L[T])}if(g||F){var k=typeof e=="function"?e.displayName||e.name||"Unknown":e;g&&a(b,k),F&&o(b,k)}return c(e,g,F,S,p,Ge.current,b)}}var h=ne.ReactCurrentOwner,_=ne.ReactDebugCurrentFrame;function R(e){if(e){var n=e._owner,i=ee(e.type,e._source,n?n.type:null);_.setExtraStackFrame(i)}else _.setExtraStackFrame(null)}var j;j=!1;function N(e){return typeof e=="object"&&e!==null&&e.$$typeof===f}function q(){{if(h.current){var e=B(h.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function I(e){return""}var we={};function it(e){{var n=q();if(!n){var i=typeof e=="string"?e:e.displayName||e.name;i&&(n=`

Check the top-level render call using <`+i+">.")}return n}}function yt(e,n){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var i=it(n);if(we[i])return;we[i]=!0;var p="";e&&e._owner&&e._owner!==h.current&&(p=" It was passed a child from "+B(e._owner.type)+"."),R(e),O('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',i,p),R(null)}}function wt(e,n){{if(typeof e!="object")return;if(Me(e))for(var i=0;i<e.length;i++){var p=e[i];N(p)&&yt(p,n)}else if(N(e))e._store&&(e._store.validated=!0);else if(e){var S=X(e);if(typeof S=="function"&&S!==e.entries)for(var T=S.call(e),b;!(b=T.next()).done;)N(b.value)&&yt(b.value,n)}}}function Ft(e){{var n=e.type;if(n==null||typeof n=="string")return;var i;if(typeof n=="function")i=n.propTypes;else if(typeof n=="object"&&(n.$$typeof===w||n.$$typeof===P))i=n.propTypes;else return;if(i){var p=B(n);nt(i,e.props,"prop",p,e)}else if(n.PropTypes!==void 0&&!j){j=!0;var S=B(n);O("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",S||"Unknown")}typeof n.getDefaultProps=="function"&&!n.getDefaultProps.isReactClassApproved&&O("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Yt(e){{for(var n=Object.keys(e.props),i=0;i<n.length;i++){var p=n[i];if(p!=="children"&&p!=="key"){R(e),O("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",p),R(null);break}}e.ref!==null&&(R(e),O("Invalid attribute `ref` supplied to `React.Fragment`."),R(null))}}var Et={};function St(e,n,i,p,S,T){{var b=Ce(e);if(!b){var g="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(g+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var F=I();F?g+=F:g+=q();var L;e===null?L="null":Me(e)?L="array":e!==void 0&&e.$$typeof===f?(L="<"+(B(e.type)||"Unknown")+" />",g=" Did you accidentally export a JSX literal instead of a component?"):L=typeof e,O("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",L,g)}var k=s(e,n,i,S,T);if(k==null)return k;if(b){var W=n.children;if(W!==void 0)if(p)if(Me(W)){for(var Ee=0;Ee<W.length;Ee++)wt(W[Ee],e);Object.freeze&&Object.freeze(W)}else O("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else wt(W,e)}if(te.call(n,"key")){var ie=B(e),U=Object.keys(n).filter(function(Gt){return Gt!=="key"}),lt=U.length>0?"{key: someKey, "+U.join(": ..., ")+": ...}":"{key: someKey}";if(!Et[ie+lt]){var Jt=U.length>0?"{"+U.join(": ..., ")+": ...}":"{}";O(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,lt,ie,Jt,ie),Et[ie+lt]=!0}}return e===m?Yt(k):Ft(k),k}}function Ut(e,n,i){return St(e,n,i,!0)}function Vt(e,n,i){return St(e,n,i,!1)}var Bt=Vt,Wt=Ut;_e.Fragment=m,_e.jsx=Bt,_e.jsxs=Wt}()),_e}process.env.NODE_ENV==="production"?ze.exports=_t():ze.exports=Tt();var d=ze.exports;const le={},dt="/api/imu/latest",Rt="/api/imu/history",Ie=12,xt=1e3,Ke="dodec-labels",ft=["dodeca-labels"],mt="dodec-activity-log",jt="Side",Nt=24*60*60*1e3,Xe="DODEC_LABEL_UPDATE",pt="DODEC_LABELS_REQUEST",ht=(()=>{const l=le==null?void 0:le.VITE_DEVICE_LABELS_URL;if(l&&l.length>0)return l;try{const f=new URL(dt,"https://placeholder.local");return`${f.origin==="https://placeholder.local"?"":`${f.protocol}//${f.host}`}/api/labels`}catch{return"/api/labels"}})(),Qe=(le==null?void 0:le.VITE_DEVICE_ACTIVITY_LOG_URL)??"/api/activity-log",Ct=5*60*1e3,vt=l=>{const f={};if(!l||typeof l!="object")return f;for(const[v,m]of Object.entries(l)){if(typeof v!="string"||v.length===0||!m||typeof m!="object")continue;const E={};for(const[D,y]of Object.entries(m)){if(typeof D!="string"||D.length===0)continue;let x=0,w=null;if(typeof y=="number")x=Number.isFinite(y)&&y>0?Math.floor(y):0;else if(y&&typeof y=="object"){const A=y.totalMs,C=y.side;typeof A=="number"&&Number.isFinite(A)&&A>0&&(x=Math.floor(A)),typeof C=="number"&&Number.isFinite(C)&&(w=Math.floor(C))}(x>0||w!==null)&&(E[D]={totalMs:x,side:w})}Object.keys(E).length>0&&(f[v]=E)}return f},Lt=Array.from({length:Ie},(l,f)=>f+1),Ze=()=>{const l={};for(const f of Lt)l[f]="";return l},Dt=()=>{if(typeof window>"u")return Ze();const l=v=>{try{const m=window.localStorage.getItem(v);if(!m)return null;const E=JSON.parse(m),D=Ze();for(const[y,x]of Object.entries(E)){const w=Number(y);Number.isFinite(w)&&w>=1&&w<=Ie&&(D[w]=String(x??""))}return D}catch(m){return console.warn("Unable to read stored labels",m),null}},f=l(Ke);if(f)return f;for(const v of ft){const m=l(v);if(m){try{window.localStorage.setItem(Ke,JSON.stringify(m))}catch{}return m}}return Ze()},gt=()=>({currentLabel:null,startTime:null,lastTimestamp:null,lastSide:null}),qe=(l,f)=>{var m;const v=(m=l[f])==null?void 0:m.trim();return v&&v.length>0?v:`${jt} ${f}`},Ot=l=>{const f=[l.received_at,l.imu_timestamp_iso];for(const v of f)if(v){const m=Date.parse(v);if(!Number.isNaN(m))return m}if(l.imu_timestamp_text){const v=l.imu_timestamp_text.replace(" ","T"),m=Date.parse(v);if(!Number.isNaN(m))return m}return Date.now()},kt=l=>{if(!l)return null;const f=Date.parse(l);return Number.isNaN(f)?null:f},ce=l=>{const f=new Date(l),v=f.getFullYear(),m=String(f.getMonth()+1).padStart(2,"0"),E=String(f.getDate()).padStart(2,"0");return`${v}-${m}-${E}`},Te=l=>{const[f,v,m]=l.split("-").map(Number);return new Date(f,v-1,m)},Fe=l=>{const f=Te(l),v=new Date(f.getFullYear(),f.getMonth(),f.getDate()).getTime(),m=v+Nt;return{start:v,end:m}},bt=l=>{const f=Te(l);return new Intl.DateTimeFormat(void 0,{dateStyle:"medium"}).format(f)},At=l=>l?l.replace("T"," ").replace(/\+.*$/,""):"Waiting for data?",Re=l=>{if(!Number.isFinite(l)||l<=0)return"00:00";const f=Math.floor(l/1e3),v=Math.floor(f/3600),m=Math.floor(f%3600/60),E=f%60;return v>0?`${String(v).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(E).padStart(2,"0")}`:`${String(m).padStart(2,"0")}:${String(E).padStart(2,"0")}`},Pt=l=>Re(l),Mt=l=>{const f=l.trim();if(!f)return NaN;const v=f.split(":");if(v.length>1){if(v.length>3)return NaN;const E=v.map(w=>Number(w));if(E.some(w=>Number.isNaN(w)||w<0))return NaN;let D=0,y=0,x=0;return E.length===3?[D,y,x]=E:[y,x]=E,Math.max(0,D*3600+y*60+x)*1e3}const m=Number(f);return Number.isNaN(m)||m<0?NaN:m*60*1e3},$e=l=>l.includes('"')||l.includes(",")||l.includes(`
`)?`"${l.replace(/"/g,'""')}"`:l;function It(){const[l,f]=u.useState(null),[v,m]=u.useState(null),[E,D]=u.useState(()=>{if(typeof window>"u")return{};try{const t=window.localStorage.getItem(mt);return t?vt(JSON.parse(t)):{}}catch(t){return console.warn("Unable to read stored activity log",t),{}}}),[y,x]=u.useState(null),[w,A]=u.useState(""),[C,P]=u.useState(""),[K,Y]=u.useState(null),[xe,Ye]=u.useState(()=>[ce(Date.now())]),[X,ne]=u.useState("week"),[O,et]=u.useState(ce(Date.now())),[ue,tt]=u.useState(ce(Date.now())),[Ue,je]=u.useState(null),[de,Ne]=u.useState(!1),[Ce,se]=u.useState(null),[V,B]=u.useState(()=>Dt()),J=u.useRef(V),Q=u.useRef(!1),re=u.useRef({}),Z=u.useRef(null),G=u.useRef(gt()),[Le,Ve]=u.useState(!1),[H,De]=u.useState(!1),[oe,Oe]=u.useState(!1),ke=u.useRef(!1),fe=u.useCallback((t,r,a,o)=>{o<=a||D(c=>{const s={...c};let h=a;for(;h<o;){const _=ce(h),{end:R}=Fe(_),j=Math.min(o,R),N=Math.max(0,j-h);if(N>0){const q={...s[_]??{}},I=q[t],we=((I==null?void 0:I.totalMs)??0)+N,it=r??(I==null?void 0:I.side)??null;q[t]={totalMs:we,side:it},s[_]=q}h=j}return s})},[]),me=u.useCallback(()=>{G.current=gt(),D(()=>({}))},[]),$=u.useCallback(t=>{const r=typeof t.side=="number"?t.side:null;if(!r)return;const a=qe(J.current,r),o=Ot(t),c=t.segment_started_at?kt(t.segment_started_at):null,s=G.current;if(s.currentLabel===null||s.startTime===null){s.currentLabel=a,s.startTime=c??o,s.lastTimestamp=o,s.lastSide=r;return}if(a===s.currentLabel){c!==null&&(s.startTime===null||c<s.startTime)&&(s.startTime=c),s.lastTimestamp=o,s.lastSide=r;return}const h=s.startTime,_=o;_>h&&fe(s.currentLabel,s.lastSide,h,_),s.currentLabel=a,s.startTime=c??o,s.lastTimestamp=o,s.lastSide=r},[fe]);u.useEffect(()=>{if(J.current=V,typeof window<"u"){const r=JSON.stringify(V);window.localStorage.setItem(Ke,r);for(const a of ft)window.localStorage.setItem(a,r);!Q.current&&window.parent&&window.parent!==window&&window.parent.postMessage({type:Xe,labels:V},"*")}Q.current=!1;const t=G.current;t.lastSide!==null&&(t.currentLabel=qe(V,t.lastSide))},[V]),u.useEffect(()=>{typeof window<"u"&&window.localStorage.setItem(mt,JSON.stringify(E))},[E]),u.useEffect(()=>{let t=!1;return(async()=>{try{const a=await fetch(Qe,{cache:"no-store"});if(!a.ok)throw new Error(`Activity log request failed with status ${a.status}`);const o=await a.json();if(t)return;o&&typeof o=="object"&&o.entries&&(ke.current=!0,D(vt(o.entries))),De(!0),Oe(!1)}catch(a){t||(console.warn("[activity-log] failed to load activity log from server",a),De(!0))}})(),()=>{t=!0}},[]),u.useEffect(()=>()=>{if(!(typeof window>"u")){for(const t of Object.keys(re.current)){const r=re.current[Number(t)];typeof r=="number"&&window.clearTimeout(r)}Z.current!==null&&window.clearTimeout(Z.current)}},[]),u.useEffect(()=>{let t=!1;return(async()=>{try{const a=await fetch(ht,{cache:"no-store"});if(!a.ok)throw new Error(`Failed to load labels (status ${a.status})`);const o=await a.json();if(t||!o||typeof o.labels!="object"||o.labels===null)return;Q.current=!0,B(c=>{const s={...c};let h=!1;for(const[_,R]of Object.entries(o.labels)){const j=Number(_);if(!Number.isFinite(j)||j<1||j>Ie)continue;const N=typeof R=="string"?R:"";s[j]!==N&&(s[j]=N,h=!0)}return h?s:c})}catch(a){console.error("[timesheet-app] failed to load labels from server",a)}})(),()=>{t=!0}},[]),u.useEffect(()=>{if(typeof window>"u")return;const t=r=>{const a=r==null?void 0:r.data;if(!(!a||typeof a!="object"))if(a.type===Xe&&a.labels&&typeof a.labels=="object"){Q.current=!0;const o=a.labels;B(c=>{const s={...c};for(const[h,_]of Object.entries(o)){const R=Number(h);!Number.isFinite(R)||R<1||R>Ie||(s[R]=typeof _=="string"?_:"")}return{...s}})}else a.type===pt&&window.parent&&window.parent!==window&&window.parent.postMessage({type:Xe,labels:J.current},r.origin||"*")};return window.addEventListener("message",t),window.parent&&window.parent!==window&&window.parent.postMessage({type:pt},"*"),()=>{window.removeEventListener("message",t)}},[]),u.useEffect(()=>{let t=!1;return(async()=>{try{const a=await fetch(`${Rt}?limit=5000`,{cache:"no-store"});if(!a.ok)throw new Error(`History request failed with status ${a.status}`);const o=await a.json();if(t)return;me();let c=null;for(const s of o){if(t)break;$(s),c=s}c&&f({side:typeof c.side=="number"?c.side:null,imu_timestamp_text:c.imu_timestamp_text??null,imu_timestamp_iso:c.imu_timestamp_iso??null,received_at:c.received_at??null,confidence:c.confidence??null}),m(null)}catch(a){t||m(a instanceof Error?a.message:"Unknown error while loading history")}finally{t||Ve(!0)}})(),()=>{t=!0}},[$,me]),u.useEffect(()=>{if(!Le)return;let t=!0;const r=async()=>{try{const o=await fetch(dt,{cache:"no-store"});if(!o.ok)throw new Error(`Request failed with status ${o.status}`);const c=await o.json();if(!t)return;$(c),f({side:typeof c.side=="number"?c.side:null,imu_timestamp_text:c.imu_timestamp_text??null,imu_timestamp_iso:c.imu_timestamp_iso??null,received_at:c.received_at??null,confidence:c.confidence??null}),m(null)}catch(o){t&&m(o instanceof Error?o.message:"Unknown error")}};r();const a=window.setInterval(r,xt);return()=>{t=!1,window.clearInterval(a)}},[$,Le]);const pe=G.current,M=pe.lastTimestamp?ce(pe.lastTimestamp):ce(Date.now());u.useEffect(()=>{Ye(t=>t.includes(M)?t:[...t,M])},[M]);const Ae=u.useCallback(async(t,r)=>{try{const a=await fetch(`${ht.replace(/\/$/,"")}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({label:r})});if(!a.ok)throw new Error(`Failed to persist label (status ${a.status})`)}catch(a){console.error(`[timesheet-app] failed to persist label for side ${t}`,a)}},[]),Pe=u.useCallback((t,r)=>{const a=r.trim();if(typeof window>"u"){Ae(t,a);return}const o=re.current[t];typeof o=="number"&&window.clearTimeout(o),re.current[t]=window.setTimeout(()=>{re.current[t]=null,Ae(t,a)},400)},[Ae]);u.useCallback(t=>r=>{const a=r.target.value;B(o=>({...o,[t]:a})),Pe(t,a)},[Pe]);const he=(t,r)=>{const a=G.current;if(!a.currentLabel||a.currentLabel!==r||a.startTime===null||a.lastTimestamp===null)return 0;const{start:o,end:c}=Fe(t),s=Math.max(o,a.startTime),h=Math.min(c,a.lastTimestamp);return h>s?h-s:0},ve=u.useCallback(t=>{const r=E[t]??{},a=Object.entries(r).map(([c,s])=>({label:c,totalMs:s.totalMs,side:s.side??null})),o=G.current;if(o.currentLabel&&o.startTime!==null&&o.lastTimestamp!==null){const c=he(t,o.currentLabel);if(c>0){const s=a.find(_=>_.label===o.currentLabel),h=o.lastSide;s?(s.totalMs+=c,s.side===null&&(s.side=h)):a.push({label:o.currentLabel,totalMs:c,side:h??null})}}return a.sort((c,s)=>s.totalMs-c.totalMs)},[E,l]),ee=u.useMemo(()=>{const t=new Set(Object.keys(E));return t.add(M),Array.from(t).sort((r,a)=>r===a?0:r>a?-1:1)},[E,M]),te=u.useMemo(()=>ee.map(t=>{const r=ve(t);if(r.length===0)return null;const a=r.reduce((o,c)=>o+c.totalMs,0);return{dateKey:t,rows:r,totalMs:a}}).filter(Boolean),[ee,ve]),Be=u.useCallback((t,r,a)=>{if(G.current.currentLabel===r&&t===M){Y("Stop the current activity before editing it.");return}x({dateKey:t,originalLabel:r}),A(Pt(a)),P(r),Y(null)},[M]),We=u.useCallback(t=>{A(t.target.value)},[]),ge=u.useCallback(t=>{P(t.target.value)},[]),nt=u.useCallback(()=>{x(null),A(""),P(""),Y(null)},[]),rt=u.useCallback(()=>{if(!y)return;const{dateKey:t,originalLabel:r}=y,a=Mt(w);if(!Number.isFinite(a)){Y("Please enter duration as mm:ss, hh:mm:ss, or minutes.");return}const o=C.trim();if(o.length===0){Y("Activity name cannot be empty.");return}const c=he(t,r);if(a<c){Y(`Duration cannot be less than the active segment (${Re(c)}).`);return}const s=Math.max(0,a-c);D(h=>{const _={...h},R={..._[t]??{}},j=R[r];if(j&&delete R[r],s>0){const N=R[o],q=((N==null?void 0:N.totalMs)??0)+s,I=o===r?(j==null?void 0:j.side)??(N==null?void 0:N.side)??null:(N==null?void 0:N.side)??(j==null?void 0:j.side)??null;R[o]={totalMs:q,side:I}}return Object.keys(R).length===0?delete _[t]:_[t]=R,_}),x(null),A(""),P(""),Y(null)},[y,w,C,he]),Me=u.useCallback((t,r)=>{if(he(t,r)>0){Y("Stop the current activity before deleting it.");return}D(o=>{const c=o[t];if(!c||!(r in c))return o;const s={...o},h={...c};return delete h[r],Object.keys(h).length===0?delete s[t]:s[t]=h,s}),y&&y.dateKey===t&&y.originalLabel===r&&(x(null),A(""),P("")),Y(null)},[y]),at=u.useCallback(t=>{Ye(r=>r.includes(t)?r.filter(a=>a!==t):[...r,t])},[]),st=()=>{if(X==="week"){const{start:c,end:s}=Fe(M),h=new Date(c);return h.setDate(h.getDate()-6),{start:new Date(h.getFullYear(),h.getMonth(),h.getDate()).getTime(),end:s}}if(X==="month"){const c=Te(M),s=new Date(c.getFullYear(),c.getMonth(),1).getTime(),h=new Date(c.getFullYear(),c.getMonth()+1,1).getTime();return{start:s,end:h}}const t=Te(O),r=Te(ue);if(Number.isNaN(t.getTime())||Number.isNaN(r.getTime())||t>r)return null;const a=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime(),o=new Date(r.getFullYear(),r.getMonth(),r.getDate()+1).getTime();return{start:a,end:o}},Je=u.useCallback(()=>{const t=st();if(!t){je("Please provide a valid date range before downloading.");return}const r=[];for(const _ of ee){const{start:R,end:j}=Fe(_);if(j<=t.start||R>=t.end)continue;const N=ve(_);if(N.length===0)continue;const q=bt(_);for(const I of N){const we=I.side!==null?`Side ${I.side}`:"";r.push(`${$e(q)},${$e(I.label)},${$e(we)},${Re(I.totalMs)}`)}}if(r.length===0){je("No activity recorded in the selected range.");return}const a=["Date,Activity,Side,Duration",...r].join(`
`),o=new Blob([a],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(o),s=document.createElement("a");s.href=c;const h=X==="custom"?"custom":X;s.download=`activity-log-${h}.csv`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(c),je(null)},[ve,X,ee,O,ue]),be=(l==null?void 0:l.side)??null,Ge=u.useMemo(()=>be===null?null:qe(V,be),[be,V]),ot=(l==null?void 0:l.imu_timestamp_text)??(l==null?void 0:l.imu_timestamp_iso)??(l==null?void 0:l.received_at)??null,z=u.useCallback(async(t=!1)=>{if(!H||!oe&&!t)return!1;try{const r=await fetch(Qe,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({entries:E})});if(!r.ok)throw new Error(`Activity log sync failed with status ${r.status}`);return Oe(!1),!0}catch(r){return console.warn("[activity-log] failed to sync activity log",r),!1}},[E,H,oe]),He=u.useCallback(async()=>{if(de)return;if(!H){se({type:"error",message:"Activity log is still loading. Please try again shortly."});return}Ne(!0),se(null),typeof window<"u"&&Z.current!==null&&(window.clearTimeout(Z.current),Z.current=null),await z(!0)?(se({type:"success",message:"Activity log saved."}),typeof window<"u"&&(Z.current=window.setTimeout(()=>{se(null),Z.current=null},4e3))):se({type:"error",message:"Unable to save activity log. Please try again."}),Ne(!1)},[H,de,z]);u.useEffect(()=>{if(H){if(ke.current){ke.current=!1;return}Oe(!0),z(!0)}},[E,H,z]),u.useEffect(()=>{if(!H||typeof window>"u")return;const t=window.setInterval(()=>{z()},Ct);return()=>window.clearInterval(t)},[H,z]),u.useEffect(()=>{if(typeof window>"u")return;const t=()=>{if(oe){if(navigator.sendBeacon)try{const r=new Blob([JSON.stringify({entries:E})],{type:"application/json"});navigator.sendBeacon(Qe,r);return}catch(r){console.warn("[activity-log] sendBeacon flush failed",r)}z(!0)}};return window.addEventListener("pagehide",t),window.addEventListener("beforeunload",t),()=>{window.removeEventListener("pagehide",t),window.removeEventListener("beforeunload",t)}},[E,oe,z]);const ye=u.useCallback(()=>{var o,c,s;if(typeof window>"u"||window.parent===window)return;const t=window.document,r=((o=t.documentElement)==null?void 0:o.scrollHeight)||((c=t.body)==null?void 0:c.scrollHeight)||window.innerHeight,a=Math.max(320,Math.min(Math.ceil(r),4e3));(s=window.parent)==null||s.postMessage({type:"EMBED_HEIGHT",height:a},"*")},[]);return u.useEffect(()=>{ye()},[ye,te.length,xe,V,y,X]),u.useEffect(()=>{if(typeof window>"u")return;const t=()=>ye();window.addEventListener("load",t),window.addEventListener("resize",t);let r=null;return typeof ResizeObserver<"u"&&(r=new ResizeObserver(t),r.observe(window.document.documentElement)),()=>{window.removeEventListener("load",t),window.removeEventListener("resize",t),r==null||r.disconnect()}},[ye]),d.jsxs("div",{className:"app-shell",children:[d.jsxs("header",{className:"app-header",children:[d.jsx("h1",{children:"Do-Decahedron Orientation"}),d.jsxs("p",{className:"status-line",children:[d.jsx("span",{className:"status-label",children:"Latest IMU update:"}),d.jsx("span",{className:"status-value",children:At(ot)})]}),d.jsxs("p",{className:"status-line",children:[d.jsx("span",{className:"status-label",children:"Current activity:"}),d.jsx("span",{className:"status-value",children:Ge??"Waiting for data?"})]}),v?d.jsxs("p",{className:"error-text",children:["Error: ",v]}):null]}),d.jsxs("section",{className:"activity-summary","aria-live":"polite",children:[d.jsx("h2",{children:"Activity Log"}),d.jsxs("div",{className:"range-controls",children:[d.jsxs("label",{className:"range-option",children:["Range",d.jsxs("select",{className:"range-select",value:X,onChange:t=>ne(t.target.value),children:[d.jsx("option",{value:"week",children:"This week"}),d.jsx("option",{value:"month",children:"This month"}),d.jsx("option",{value:"custom",children:"Custom"})]})]}),X==="custom"?d.jsxs(d.Fragment,{children:[d.jsxs("label",{className:"range-option",children:["From",d.jsx("input",{type:"date",className:"date-input",value:O,max:ue,onChange:t=>et(t.target.value)})]}),d.jsxs("label",{className:"range-option",children:["To",d.jsx("input",{type:"date",className:"date-input",value:ue,min:O,onChange:t=>tt(t.target.value)})]})]}):null,d.jsx("button",{type:"button",className:"download-button push-right",onClick:Je,children:"Download CSV"}),d.jsx("button",{type:"button",className:"download-button save-button",onClick:He,disabled:de,children:de?"Saving...":"Save Changes"})]}),Ue?d.jsx("p",{className:"error-text",children:Ue}):null,Ce?d.jsx("p",{className:Ce.type==="error"?"error-text":"success-text",children:Ce.message}):null,te.length===0?d.jsx("p",{className:"placeholder-text",children:"No activity recorded yet."}):te.map(({dateKey:t,rows:r,totalMs:a})=>{const o=xe.includes(t),c=G.current;return d.jsxs("div",{className:"date-group",children:[d.jsxs("button",{type:"button",className:`date-header${o?" date-header--expanded":""}`,onClick:()=>at(t),children:[d.jsxs("div",{className:"date-header__title",children:[d.jsx("span",{className:"date-label",children:bt(t)}),d.jsxs("span",{className:"date-summary",children:[r.length," activit",r.length===1?"y":"ies"," - ",Re(a)]})]}),d.jsx("span",{className:"date-header__icon",children:o?"−":"+"})]}),o?d.jsxs("table",{className:"activity-table",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{scope:"col",children:"Activity"}),d.jsx("th",{scope:"col",className:"side-heading",children:"Side"}),d.jsx("th",{scope:"col",children:"Total Duration"}),d.jsx("th",{scope:"col",className:"actions-heading",children:"Actions"})]})}),d.jsx("tbody",{children:r.map(s=>{const h=(y==null?void 0:y.dateKey)===t&&y.originalLabel===s.label,_=c.currentLabel===s.label&&t===M;return d.jsxs("tr",{children:[d.jsx("td",{children:h?d.jsx("input",{type:"text",className:"duration-input",value:C,onChange:ge,placeholder:"Activity name"}):d.jsx("span",{children:s.label})}),d.jsx("td",{className:"side-cell",children:d.jsx("span",{children:s.side!==null?`Side ${s.side}`:"—"})}),d.jsx("td",{children:h?d.jsx("input",{type:"text",className:"duration-input",value:w,onChange:We,placeholder:"mm:ss or hh:mm:ss"}):d.jsx("span",{children:Re(s.totalMs)})}),d.jsx("td",{className:"actions-cell",children:d.jsx("div",{className:"action-buttons",children:h?d.jsxs(d.Fragment,{children:[d.jsx("button",{type:"button",className:"icon-button icon-button--primary",onClick:rt,children:"Save"}),d.jsx("button",{type:"button",className:"icon-button",onClick:nt,children:"Cancel"})]}):d.jsxs(d.Fragment,{children:[d.jsx("button",{type:"button",className:"icon-button",disabled:_,onClick:()=>Be(t,s.label,s.totalMs),children:"Edit"}),d.jsx("button",{type:"button",className:"icon-button icon-button--danger",disabled:_,onClick:()=>Me(t,s.label),children:"Delete"})]})})})]},`${t}-${s.label}`)})})]}):null]},t)}),K?d.jsx("p",{className:"error-text",children:K}):null]})]})}ae.TimesheetDevice=It,Object.defineProperty(ae,Symbol.toStringTag,{value:"Module"})});
