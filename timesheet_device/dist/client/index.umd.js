(function(H,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],d):(H=typeof globalThis<"u"?globalThis:H||self,d(H.TimesheetDeviceUI={},H.React))})(this,function(H,d){"use strict";var Re={exports:{}},ie={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ye;function st(){if(Ye)return ie;Ye=1;var c=d,m=Symbol.for("react.element"),y=Symbol.for("react.fragment"),g=Object.prototype.hasOwnProperty,x=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,L={key:!0,ref:!0,__self:!0,__source:!0};function S(D,E,F){var N,C={},V=null,z=null;F!==void 0&&(V=""+F),E.key!==void 0&&(V=""+E.key),E.ref!==void 0&&(z=E.ref);for(N in E)g.call(E,N)&&!L.hasOwnProperty(N)&&(C[N]=E[N]);if(D&&D.defaultProps)for(N in E=D.defaultProps,E)C[N]===void 0&&(C[N]=E[N]);return{$$typeof:m,type:D,key:V,ref:z,props:C,_owner:x.current}}return ie.Fragment=y,ie.jsx=S,ie.jsxs=S,ie}var le={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ue;function ot(){return Ue||(Ue=1,process.env.NODE_ENV!=="production"&&function(){var c=d,m=Symbol.for("react.element"),y=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),D=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),z=Symbol.for("react.offscreen"),U=Symbol.iterator,je="@@iterator";function $(e){if(e===null||typeof e!="object")return null;var n=U&&e[U]||e[je];return typeof n=="function"?n:null}var J=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function T(e){{for(var n=arguments.length,a=new Array(n>1?n-1:0),f=1;f<n;f++)a[f-1]=arguments[f];Ce("error",e,a)}}function Ce(e,n,a){{var f=J.ReactDebugCurrentFrame,b=f.getStackAddendum();b!==""&&(n+="%s",a=a.concat([b]));var _=a.map(function(h){return String(h)});_.unshift("Warning: "+n),Function.prototype.apply.call(console[e],console,_)}}var ge=!1,fe=!1,B=!1,De=!1,be=!1,I;I=Symbol.for("react.module.reference");function ye(e){return!!(typeof e=="string"||typeof e=="function"||e===g||e===L||be||e===x||e===F||e===N||De||e===z||ge||fe||B||typeof e=="object"&&e!==null&&(e.$$typeof===V||e.$$typeof===C||e.$$typeof===S||e.$$typeof===D||e.$$typeof===E||e.$$typeof===I||e.getModuleId!==void 0))}function Ne(e,n,a){var f=e.displayName;if(f)return f;var b=n.displayName||n.name||"";return b!==""?a+"("+b+")":a}function de(e){return e.displayName||"Context"}function Y(e){if(e==null)return null;if(typeof e.tag=="number"&&T("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case g:return"Fragment";case y:return"Portal";case L:return"Profiler";case x:return"StrictMode";case F:return"Suspense";case N:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case D:var n=e;return de(n)+".Consumer";case S:var a=e;return de(a._context)+".Provider";case E:return Ne(e,e.render,"ForwardRef");case C:var f=e.displayName||null;return f!==null?f:Y(e.type)||"Memo";case V:{var b=e,_=b._payload,h=b._init;try{return Y(h(_))}catch{return null}}}return null}var A=Object.assign,G=0,P,ee,X,K,me,_e,Ee;function xe(){}xe.__reactDisabledLog=!0;function Oe(){{if(G===0){P=console.log,ee=console.info,X=console.warn,K=console.error,me=console.group,_e=console.groupCollapsed,Ee=console.groupEnd;var e={configurable:!0,enumerable:!0,value:xe,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}G++}}function ke(){{if(G--,G===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:A({},e,{value:P}),info:A({},e,{value:ee}),warn:A({},e,{value:X}),error:A({},e,{value:K}),group:A({},e,{value:me}),groupCollapsed:A({},e,{value:_e}),groupEnd:A({},e,{value:Ee})})}G<0&&T("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var pe=J.ReactCurrentDispatcher,ve;function te(e,n,a){{if(ve===void 0)try{throw Error()}catch(b){var f=b.stack.trim().match(/\n( *(at )?)/);ve=f&&f[1]||""}return`
`+ve+e}}var Z=!1,ne;{var Pe=typeof WeakMap=="function"?WeakMap:Map;ne=new Pe}function t(e,n){if(!e||Z)return"";{var a=ne.get(e);if(a!==void 0)return a}var f;Z=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var _;_=pe.current,pe.current=null,Oe();try{if(n){var h=function(){throw Error()};if(Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(k){f=k}Reflect.construct(e,[],h)}else{try{h.call()}catch(k){f=k}e.call(h.prototype)}}else{try{throw Error()}catch(k){f=k}e()}}catch(k){if(k&&f&&typeof k.stack=="string"){for(var v=k.stack.split(`
`),O=f.stack.split(`
`),R=v.length-1,w=O.length-1;R>=1&&w>=0&&v[R]!==O[w];)w--;for(;R>=1&&w>=0;R--,w--)if(v[R]!==O[w]){if(R!==1||w!==1)do if(R--,w--,w<0||v[R]!==O[w]){var M=`
`+v[R].replace(" at new "," at ");return e.displayName&&M.includes("<anonymous>")&&(M=M.replace("<anonymous>",e.displayName)),typeof e=="function"&&ne.set(e,M),M}while(R>=1&&w>=0);break}}}finally{Z=!1,pe.current=_,ke(),Error.prepareStackTrace=b}var oe=e?e.displayName||e.name:"",Q=oe?te(oe):"";return typeof e=="function"&&ne.set(e,Q),Q}function s(e,n,a){return t(e,!1)}function i(e){var n=e.prototype;return!!(n&&n.isReactComponent)}function l(e,n,a){if(e==null)return"";if(typeof e=="function")return t(e,i(e));if(typeof e=="string")return te(e);switch(e){case F:return te("Suspense");case N:return te("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case E:return s(e.render);case C:return l(e.type,n,a);case V:{var f=e,b=f._payload,_=f._init;try{return l(_(b),n,a)}catch{}}}return""}var r=Object.prototype.hasOwnProperty,u={},p=J.ReactDebugCurrentFrame;function j(e){if(e){var n=e._owner,a=l(e.type,e._source,n?n.type:null);p.setExtraStackFrame(a)}else p.setExtraStackFrame(null)}function re(e,n,a,f,b){{var _=Function.call.bind(r);for(var h in e)if(_(e,h)){var v=void 0;try{if(typeof e[h]!="function"){var O=Error((f||"React class")+": "+a+" type `"+h+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[h]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw O.name="Invariant Violation",O}v=e[h](n,h,f,a,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(R){v=R}v&&!(v instanceof Error)&&(j(b),T("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",f||"React class",a,h,typeof v),j(null)),v instanceof Error&&!(v.message in u)&&(u[v.message]=!0,j(b),T("Failed %s type: %s",a,v.message),j(null))}}}var ae=Array.isArray;function W(e){return ae(e)}function Le(e){{var n=typeof Symbol=="function"&&Symbol.toStringTag,a=n&&e[Symbol.toStringTag]||e.constructor.name||"Object";return a}}function Se(e){try{return ze(e),!1}catch{return!0}}function ze(e){return""+e}function Xe(e){if(Se(e))return T("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Le(e)),ze(e)}var Ke=J.ReactCurrentOwner,bt={key:!0,ref:!0,__self:!0,__source:!0},Ze,Qe;function yt(e){if(r.call(e,"ref")){var n=Object.getOwnPropertyDescriptor(e,"ref").get;if(n&&n.isReactWarning)return!1}return e.ref!==void 0}function _t(e){if(r.call(e,"key")){var n=Object.getOwnPropertyDescriptor(e,"key").get;if(n&&n.isReactWarning)return!1}return e.key!==void 0}function Et(e,n){typeof e.ref=="string"&&Ke.current}function xt(e,n){{var a=function(){Ze||(Ze=!0,T("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",n))};a.isReactWarning=!0,Object.defineProperty(e,"key",{get:a,configurable:!0})}}function St(e,n){{var a=function(){Qe||(Qe=!0,T("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",n))};a.isReactWarning=!0,Object.defineProperty(e,"ref",{get:a,configurable:!0})}}var Rt=function(e,n,a,f,b,_,h){var v={$$typeof:m,type:e,key:n,ref:a,props:h,_owner:_};return v._store={},Object.defineProperty(v._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(v,"_self",{configurable:!1,enumerable:!1,writable:!1,value:f}),Object.defineProperty(v,"_source",{configurable:!1,enumerable:!1,writable:!1,value:b}),Object.freeze&&(Object.freeze(v.props),Object.freeze(v)),v};function Tt(e,n,a,f,b){{var _,h={},v=null,O=null;a!==void 0&&(Xe(a),v=""+a),_t(n)&&(Xe(n.key),v=""+n.key),yt(n)&&(O=n.ref,Et(n,b));for(_ in n)r.call(n,_)&&!bt.hasOwnProperty(_)&&(h[_]=n[_]);if(e&&e.defaultProps){var R=e.defaultProps;for(_ in R)h[_]===void 0&&(h[_]=R[_])}if(v||O){var w=typeof e=="function"?e.displayName||e.name||"Unknown":e;v&&xt(h,w),O&&St(h,w)}return Rt(e,v,O,b,f,Ke.current,h)}}var Fe=J.ReactCurrentOwner,qe=J.ReactDebugCurrentFrame;function se(e){if(e){var n=e._owner,a=l(e.type,e._source,n?n.type:null);qe.setExtraStackFrame(a)}else qe.setExtraStackFrame(null)}var Ae;Ae=!1;function Me(e){return typeof e=="object"&&e!==null&&e.$$typeof===m}function $e(){{if(Fe.current){var e=Y(Fe.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function wt(e){return""}var et={};function jt(e){{var n=$e();if(!n){var a=typeof e=="string"?e:e.displayName||e.name;a&&(n=`

Check the top-level render call using <`+a+">.")}return n}}function tt(e,n){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var a=jt(n);if(et[a])return;et[a]=!0;var f="";e&&e._owner&&e._owner!==Fe.current&&(f=" It was passed a child from "+Y(e._owner.type)+"."),se(e),T('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',a,f),se(null)}}function nt(e,n){{if(typeof e!="object")return;if(W(e))for(var a=0;a<e.length;a++){var f=e[a];Me(f)&&tt(f,n)}else if(Me(e))e._store&&(e._store.validated=!0);else if(e){var b=$(e);if(typeof b=="function"&&b!==e.entries)for(var _=b.call(e),h;!(h=_.next()).done;)Me(h.value)&&tt(h.value,n)}}}function Ct(e){{var n=e.type;if(n==null||typeof n=="string")return;var a;if(typeof n=="function")a=n.propTypes;else if(typeof n=="object"&&(n.$$typeof===E||n.$$typeof===C))a=n.propTypes;else return;if(a){var f=Y(n);re(a,e.props,"prop",f,e)}else if(n.PropTypes!==void 0&&!Ae){Ae=!0;var b=Y(n);T("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",b||"Unknown")}typeof n.getDefaultProps=="function"&&!n.getDefaultProps.isReactClassApproved&&T("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Dt(e){{for(var n=Object.keys(e.props),a=0;a<n.length;a++){var f=n[a];if(f!=="children"&&f!=="key"){se(e),T("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",f),se(null);break}}e.ref!==null&&(se(e),T("Invalid attribute `ref` supplied to `React.Fragment`."),se(null))}}var rt={};function at(e,n,a,f,b,_){{var h=ye(e);if(!h){var v="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(v+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var O=wt();O?v+=O:v+=$e();var R;e===null?R="null":W(e)?R="array":e!==void 0&&e.$$typeof===m?(R="<"+(Y(e.type)||"Unknown")+" />",v=" Did you accidentally export a JSX literal instead of a component?"):R=typeof e,T("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",R,v)}var w=Tt(e,n,a,b,_);if(w==null)return w;if(h){var M=n.children;if(M!==void 0)if(f)if(W(M)){for(var oe=0;oe<M.length;oe++)nt(M[oe],e);Object.freeze&&Object.freeze(M)}else T("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else nt(M,e)}if(r.call(n,"key")){var Q=Y(e),k=Object.keys(n).filter(function(Ft){return Ft!=="key"}),Ie=k.length>0?"{key: someKey, "+k.join(": ..., ")+": ...}":"{key: someKey}";if(!rt[Q+Ie]){var Lt=k.length>0?"{"+k.join(": ..., ")+": ...}":"{}";T(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Ie,Q,Lt,Q),rt[Q+Ie]=!0}}return e===g?Dt(w):Ct(w),w}}function Nt(e,n,a){return at(e,n,a,!0)}function Ot(e,n,a){return at(e,n,a,!1)}var kt=Ot,Pt=Nt;le.Fragment=g,le.jsx=kt,le.jsxs=Pt}()),le}process.env.NODE_ENV==="production"?Re.exports=st():Re.exports=ot();var o=Re.exports;const it="/api/imu/latest",lt="/api/imu/history",We=12,ct=1e3,Ve="dodec-labels",Be="dodec-activity-log",ut="Side",ft=24*60*60*1e3,dt=Array.from({length:We},(c,m)=>m+1),Te=()=>{const c={};for(const m of dt)c[m]="";return c},Je=()=>({currentLabel:null,startTime:null,lastTimestamp:null,lastSide:null}),we=(c,m)=>{var g;const y=(g=c[m])==null?void 0:g.trim();return y&&y.length>0?y:`${ut} ${m}`},mt=c=>{const m=[c.received_at,c.imu_timestamp_iso];for(const y of m)if(y){const g=Date.parse(y);if(!Number.isNaN(g))return g}if(c.imu_timestamp_text){const y=c.imu_timestamp_text.replace(" ","T"),g=Date.parse(y);if(!Number.isNaN(g))return g}return Date.now()},q=c=>{const m=new Date(c),y=m.getFullYear(),g=String(m.getMonth()+1).padStart(2,"0"),x=String(m.getDate()).padStart(2,"0");return`${y}-${g}-${x}`},ce=c=>{const[m,y,g]=c.split("-").map(Number);return new Date(m,y-1,g)},he=c=>{const m=ce(c),y=new Date(m.getFullYear(),m.getMonth(),m.getDate()).getTime(),g=y+ft;return{start:y,end:g}},Ge=c=>{const m=ce(c);return new Intl.DateTimeFormat(void 0,{dateStyle:"medium"}).format(m)},pt=c=>c?c.replace("T"," ").replace(/\+.*$/,""):"Waiting for data?",ue=c=>{if(!Number.isFinite(c)||c<=0)return"00:00";const m=Math.floor(c/1e3),y=Math.floor(m/3600),g=Math.floor(m%3600/60),x=m%60;return y>0?`${String(y).padStart(2,"0")}:${String(g).padStart(2,"0")}:${String(x).padStart(2,"0")}`:`${String(g).padStart(2,"0")}:${String(x).padStart(2,"0")}`},vt=c=>ue(c),ht=c=>{const m=c.trim();if(!m)return NaN;const y=m.split(":");if(y.length>1){if(y.length>3)return NaN;const x=y.map(E=>Number(E));if(x.some(E=>Number.isNaN(E)||E<0))return NaN;let L=0,S=0,D=0;return x.length===3?[L,S,D]=x:[S,D]=x,Math.max(0,L*3600+S*60+D)*1e3}const g=Number(m);return Number.isNaN(g)||g<0?NaN:g*60*1e3},He=c=>c.includes('"')||c.includes(",")||c.includes(`
`)?`"${c.replace(/"/g,'""')}"`:c;function gt(){const[c,m]=d.useState(null),[y,g]=d.useState(null),[x,L]=d.useState(()=>{if(typeof window>"u")return{};try{const t=window.localStorage.getItem(Be);return t?JSON.parse(t):{}}catch(t){return console.warn("Unable to read stored activity log",t),{}}}),[S,D]=d.useState(null),[E,F]=d.useState(""),[N,C]=d.useState(null),[V,z]=d.useState(()=>[q(Date.now())]),[U,je]=d.useState("week"),[$,J]=d.useState(q(Date.now())),[T,Ce]=d.useState(q(Date.now())),[ge,fe]=d.useState(null),[B,De]=d.useState(()=>{if(typeof window>"u")return Te();try{const t=window.localStorage.getItem(Ve);if(t){const s=JSON.parse(t),i=Te();for(const[l,r]of Object.entries(s)){const u=Number(l);Number.isFinite(u)&&u>=1&&u<=We&&(i[u]=String(r))}return i}}catch(t){console.warn("Unable to read stored labels",t)}return Te()}),be=d.useRef(B),I=d.useRef(Je()),[ye,Ne]=d.useState(!1),de=d.useCallback((t,s,i)=>{i<=s||L(l=>{const r={...l};let u=s;for(;u<i;){const p=q(u),{end:j}=he(p),re=Math.min(i,j),ae=Math.max(0,re-u);if(ae>0){const W={...r[p]??{}};W[t]=(W[t]??0)+ae,r[p]=W}u=re}return r})},[]),Y=d.useCallback(()=>{I.current=Je(),L(()=>({}))},[]),A=d.useCallback(t=>{const s=typeof t.side=="number"?t.side:null;if(!s)return;const i=we(be.current,s),l=mt(t),r=I.current;if(r.currentLabel===null||r.startTime===null){r.currentLabel=i,r.startTime=l,r.lastTimestamp=l,r.lastSide=s;return}if(i===r.currentLabel){r.lastTimestamp=l,r.lastSide=s;return}const u=r.startTime,p=l;p>u&&de(r.currentLabel,u,p),r.currentLabel=i,r.startTime=l,r.lastTimestamp=l,r.lastSide=s},[de]);d.useEffect(()=>{be.current=B,typeof window<"u"&&window.localStorage.setItem(Ve,JSON.stringify(B));const t=I.current;t.lastSide!==null&&(t.currentLabel=we(B,t.lastSide))},[B]),d.useEffect(()=>{typeof window<"u"&&window.localStorage.setItem(Be,JSON.stringify(x))},[x]),d.useEffect(()=>{let t=!1;return(async()=>{try{const i=await fetch(`${lt}?limit=5000`,{cache:"no-store"});if(!i.ok)throw new Error(`History request failed with status ${i.status}`);const l=await i.json();if(t)return;Y();let r=null;for(const u of l){if(t)break;A(u),r=u}r&&m({side:typeof r.side=="number"?r.side:null,imu_timestamp_text:r.imu_timestamp_text??null,imu_timestamp_iso:r.imu_timestamp_iso??null,received_at:r.received_at??null,confidence:r.confidence??null}),g(null)}catch(i){t||g(i instanceof Error?i.message:"Unknown error while loading history")}finally{t||Ne(!0)}})(),()=>{t=!0}},[A,Y]),d.useEffect(()=>{if(!ye)return;let t=!0;const s=async()=>{try{const l=await fetch(it,{cache:"no-store"});if(!l.ok)throw new Error(`Request failed with status ${l.status}`);const r=await l.json();if(!t)return;A(r),m({side:typeof r.side=="number"?r.side:null,imu_timestamp_text:r.imu_timestamp_text??null,imu_timestamp_iso:r.imu_timestamp_iso??null,received_at:r.received_at??null,confidence:r.confidence??null}),g(null)}catch(l){t&&g(l instanceof Error?l.message:"Unknown error")}};s();const i=window.setInterval(s,ct);return()=>{t=!1,window.clearInterval(i)}},[A,ye]);const G=I.current,P=G.lastTimestamp?q(G.lastTimestamp):q(Date.now());d.useEffect(()=>{z(t=>t.includes(P)?t:[...t,P])},[P]),d.useCallback(t=>s=>{const i=s.target.value;De(l=>({...l,[t]:i}))},[]);const ee=(t,s)=>{const i=I.current;if(!i.currentLabel||i.currentLabel!==s||i.startTime===null||i.lastTimestamp===null)return 0;const{start:l,end:r}=he(t),u=Math.max(l,i.startTime),p=Math.min(r,i.lastTimestamp);return p>u?p-u:0},X=d.useCallback(t=>{const s=x[t]??{},i=Object.entries(s).map(([r,u])=>({label:r,totalMs:u})),l=I.current;if(l.currentLabel&&l.startTime!==null&&l.lastTimestamp!==null){const r=ee(t,l.currentLabel);if(r>0){const u=i.find(p=>p.label===l.currentLabel);u?u.totalMs+=r:i.push({label:l.currentLabel,totalMs:r})}}return i.sort((r,u)=>u.totalMs-r.totalMs)},[x,c]),K=d.useMemo(()=>{const t=new Set(Object.keys(x));return t.add(P),Array.from(t).sort((s,i)=>s===i?0:s>i?-1:1)},[x,P]),me=d.useMemo(()=>K.map(t=>{const s=X(t);if(s.length===0)return null;const i=s.reduce((l,r)=>l+r.totalMs,0);return{dateKey:t,rows:s,totalMs:i}}).filter(Boolean),[K,X]),_e=d.useCallback((t,s,i)=>{if(I.current.currentLabel===s&&t===P){C("Stop the current activity before editing it.");return}D({dateKey:t,label:s}),F(vt(i)),C(null)},[P]),Ee=d.useCallback(t=>{F(t.target.value)},[]),xe=d.useCallback(()=>{D(null),F(""),C(null)},[]),Oe=d.useCallback(()=>{if(!S)return;const{dateKey:t,label:s}=S,i=ht(E);if(!Number.isFinite(i)){C("Please enter duration as mm:ss, hh:mm:ss, or minutes.");return}const l=ee(t,s);if(i<l){C(`Duration cannot be less than the active segment (${ue(l)}).`);return}const r=Math.max(0,i-l);L(u=>{const p={...u},j={...p[t]??{}};return r<=0?delete j[s]:j[s]=r,Object.keys(j).length===0?delete p[t]:p[t]=j,p}),D(null),F(""),C(null)},[S,E]),ke=d.useCallback((t,s)=>{if(ee(t,s)>0){C("Stop the current activity before deleting it.");return}L(l=>{const r=l[t];if(!r||!(s in r))return l;const u={...l},p={...r};return delete p[s],Object.keys(p).length===0?delete u[t]:u[t]=p,u}),S&&S.dateKey===t&&S.label===s&&(D(null),F("")),C(null)},[S]),pe=d.useCallback(t=>{z(s=>s.includes(t)?s.filter(i=>i!==t):[...s,t])},[]),ve=()=>{if(U==="week"){const{start:r,end:u}=he(P),p=new Date(r);return p.setDate(p.getDate()-6),{start:new Date(p.getFullYear(),p.getMonth(),p.getDate()).getTime(),end:u}}if(U==="month"){const r=ce(P),u=new Date(r.getFullYear(),r.getMonth(),1).getTime(),p=new Date(r.getFullYear(),r.getMonth()+1,1).getTime();return{start:u,end:p}}const t=ce($),s=ce(T);if(Number.isNaN(t.getTime())||Number.isNaN(s.getTime())||t>s)return null;const i=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime(),l=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1).getTime();return{start:i,end:l}},te=d.useCallback(()=>{const t=ve();if(!t){fe("Please provide a valid date range before downloading.");return}const s=[];for(const j of K){const{start:re,end:ae}=he(j);if(ae<=t.start||re>=t.end)continue;const W=X(j);if(W.length===0)continue;const Le=Ge(j);for(const Se of W)s.push(`${He(Le)},${He(Se.label)},${ue(Se.totalMs)}`)}if(s.length===0){fe("No activity recorded in the selected range.");return}const i=["Date,Activity,Duration",...s].join(`
`),l=new Blob([i],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(l),u=document.createElement("a");u.href=r;const p=U==="custom"?"custom":U;u.download=`activity-log-${p}.csv`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(r),fe(null)},[X,U,K,$,T]),Z=(c==null?void 0:c.side)??null,ne=d.useMemo(()=>Z===null?null:we(B,Z),[Z,B]),Pe=(c==null?void 0:c.imu_timestamp_text)??(c==null?void 0:c.imu_timestamp_iso)??(c==null?void 0:c.received_at)??null;return o.jsxs("div",{className:"app-shell",children:[o.jsxs("header",{className:"app-header",children:[o.jsx("h1",{children:"Do-Decahedron Orientation"}),o.jsxs("p",{className:"status-line",children:[o.jsx("span",{className:"status-label",children:"Latest IMU update:"}),o.jsx("span",{className:"status-value",children:pt(Pe)})]}),o.jsxs("p",{className:"status-line",children:[o.jsx("span",{className:"status-label",children:"Current activity:"}),o.jsx("span",{className:"status-value",children:ne??"Waiting for data?"})]}),y?o.jsxs("p",{className:"error-text",children:["Error: ",y]}):null]}),o.jsxs("section",{className:"activity-summary","aria-live":"polite",children:[o.jsx("h2",{children:"Activity Log"}),o.jsxs("div",{className:"range-controls",children:[o.jsxs("label",{className:"range-option",children:["Range",o.jsxs("select",{className:"range-select",value:U,onChange:t=>je(t.target.value),children:[o.jsx("option",{value:"week",children:"This week"}),o.jsx("option",{value:"month",children:"This month"}),o.jsx("option",{value:"custom",children:"Custom"})]})]}),U==="custom"?o.jsxs(o.Fragment,{children:[o.jsxs("label",{className:"range-option",children:["From",o.jsx("input",{type:"date",className:"date-input",value:$,max:T,onChange:t=>J(t.target.value)})]}),o.jsxs("label",{className:"range-option",children:["To",o.jsx("input",{type:"date",className:"date-input",value:T,min:$,onChange:t=>Ce(t.target.value)})]})]}):null,o.jsx("button",{type:"button",className:"download-button",onClick:te,children:"Download CSV"})]}),ge?o.jsx("p",{className:"error-text",children:ge}):null,me.length===0?o.jsx("p",{className:"placeholder-text",children:"No activity recorded yet."}):me.map(({dateKey:t,rows:s,totalMs:i})=>{const l=V.includes(t),r=I.current;return o.jsxs("div",{className:"date-group",children:[o.jsxs("button",{type:"button",className:`date-header${l?" date-header--expanded":""}`,onClick:()=>pe(t),children:[o.jsxs("div",{className:"date-header__title",children:[o.jsx("span",{className:"date-label",children:Ge(t)}),o.jsxs("span",{className:"date-summary",children:[s.length," activit",s.length===1?"y":"ies"," - ",ue(i)]})]}),o.jsx("span",{className:"date-header__icon",children:l?"−":"+"})]}),l?o.jsxs("table",{className:"activity-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"Activity"}),o.jsx("th",{scope:"col",children:"Total Duration"}),o.jsx("th",{scope:"col",className:"actions-heading",children:"Actions"})]})}),o.jsx("tbody",{children:s.map(u=>{const p=(S==null?void 0:S.dateKey)===t&&S.label===u.label,j=r.currentLabel===u.label&&t===P;return o.jsxs("tr",{children:[o.jsx("td",{children:u.label}),o.jsx("td",{children:p?o.jsx("input",{type:"text",className:"duration-input",value:E,onChange:Ee,placeholder:"mm:ss or hh:mm:ss"}):o.jsx("span",{children:ue(u.totalMs)})}),o.jsx("td",{className:"actions-cell",children:o.jsx("div",{className:"action-buttons",children:p?o.jsxs(o.Fragment,{children:[o.jsx("button",{type:"button",className:"icon-button icon-button--primary",onClick:Oe,children:"Save"}),o.jsx("button",{type:"button",className:"icon-button",onClick:xe,children:"Cancel"})]}):o.jsxs(o.Fragment,{children:[o.jsx("button",{type:"button",className:"icon-button",disabled:j,onClick:()=>_e(t,u.label,u.totalMs),children:"Edit"}),o.jsx("button",{type:"button",className:"icon-button icon-button--danger",disabled:j,onClick:()=>ke(t,u.label),children:"Delete"})]})})})]},`${t}-${u.label}`)})})]}):null]},t)}),N?o.jsx("p",{className:"error-text",children:N}):null]})]})}H.TimesheetDevice=gt,Object.defineProperty(H,Symbol.toStringTag,{value:"Module"})});
