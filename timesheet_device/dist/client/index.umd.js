(function(X,m){typeof exports=="object"&&typeof module<"u"?m(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],m):(X=typeof globalThis<"u"?globalThis:X||self,m(X.TimesheetDeviceUI={},X.React))})(this,function(X,m){"use strict";var je={exports:{}},se={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Me;function rt(){if(Me)return se;Me=1;var i=m,p=Symbol.for("react.element"),y=Symbol.for("react.fragment"),g=Object.prototype.hasOwnProperty,x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,A={key:!0,ref:!0,__self:!0,__source:!0};function S(D,_,L){var O,C={},U=null,H=null;L!==void 0&&(U=""+L),_.key!==void 0&&(U=""+_.key),_.ref!==void 0&&(H=_.ref);for(O in _)g.call(_,O)&&!A.hasOwnProperty(O)&&(C[O]=_[O]);if(D&&D.defaultProps)for(O in _=D.defaultProps,_)C[O]===void 0&&(C[O]=_[O]);return{$$typeof:p,type:D,key:U,ref:H,props:C,_owner:x.current}}return se.Fragment=y,se.jsx=S,se.jsxs=S,se}var oe={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ie;function at(){return Ie||(Ie=1,process.env.NODE_ENV!=="production"&&function(){var i=m,p=Symbol.for("react.element"),y=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),D=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),H=Symbol.for("react.offscreen"),M=Symbol.iterator,we="@@iterator";function ee(e){if(e===null||typeof e!="object")return null;var n=M&&e[M]||e[we];return typeof n=="function"?n:null}var J=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function R(e){{for(var n=arguments.length,r=new Array(n>1?n-1:0),f=1;f<n;f++)r[f-1]=arguments[f];Ce("error",e,r)}}function Ce(e,n,r){{var f=J.ReactDebugCurrentFrame,b=f.getStackAddendum();b!==""&&(n+="%s",r=r.concat([b]));var E=r.map(function(h){return String(h)});E.unshift("Warning: "+n),Function.prototype.apply.call(console[e],console,E)}}var ve=!1,ce=!1,I=!1,Ne=!1,he=!1,Y;Y=Symbol.for("react.module.reference");function ge(e){return!!(typeof e=="string"||typeof e=="function"||e===g||e===A||he||e===x||e===L||e===O||Ne||e===H||ve||ce||I||typeof e=="object"&&e!==null&&(e.$$typeof===U||e.$$typeof===C||e.$$typeof===S||e.$$typeof===D||e.$$typeof===_||e.$$typeof===Y||e.getModuleId!==void 0))}function be(e,n,r){var f=e.displayName;if(f)return f;var b=n.displayName||n.name||"";return b!==""?r+"("+b+")":r}function ue(e){return e.displayName||"Context"}function w(e){if(e==null)return null;if(typeof e.tag=="number"&&R("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case g:return"Fragment";case y:return"Portal";case A:return"Profiler";case x:return"StrictMode";case L:return"Suspense";case O:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case D:var n=e;return ue(n)+".Consumer";case S:var r=e;return ue(r._context)+".Provider";case _:return be(e,e.render,"ForwardRef");case C:var f=e.displayName||null;return f!==null?f:w(e.type)||"Memo";case U:{var b=e,E=b._payload,h=b._init;try{return w(h(E))}catch{return null}}}return null}var W=Object.assign,V=0,K,Z,fe,ye,Ee,_e,xe;function Se(){}Se.__reactDisabledLog=!0;function De(){{if(V===0){K=console.log,Z=console.info,fe=console.warn,ye=console.error,Ee=console.group,_e=console.groupCollapsed,xe=console.groupEnd;var e={configurable:!0,enumerable:!0,value:Se,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}V++}}function Oe(){{if(V--,V===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:W({},e,{value:K}),info:W({},e,{value:Z}),warn:W({},e,{value:fe}),error:W({},e,{value:ye}),group:W({},e,{value:Ee}),groupCollapsed:W({},e,{value:_e}),groupEnd:W({},e,{value:xe})})}V<0&&R("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var de=J.ReactCurrentDispatcher,G;function te(e,n,r){{if(G===void 0)try{throw Error()}catch(b){var f=b.stack.trim().match(/\n( *(at )?)/);G=f&&f[1]||""}return`
`+G+e}}var me=!1,t;{var o=typeof WeakMap=="function"?WeakMap:Map;t=new o}function u(e,n){if(!e||me)return"";{var r=t.get(e);if(r!==void 0)return r}var f;me=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var E;E=de.current,de.current=null,De();try{if(n){var h=function(){throw Error()};if(Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(P){f=P}Reflect.construct(e,[],h)}else{try{h.call()}catch(P){f=P}e.call(h.prototype)}}else{try{throw Error()}catch(P){f=P}e()}}catch(P){if(P&&f&&typeof P.stack=="string"){for(var v=P.stack.split(`
`),k=f.stack.split(`
`),j=v.length-1,T=k.length-1;j>=1&&T>=0&&v[j]!==k[T];)T--;for(;j>=1&&T>=0;j--,T--)if(v[j]!==k[T]){if(j!==1||T!==1)do if(j--,T--,T<0||v[j]!==k[T]){var F=`
`+v[j].replace(" at new "," at ");return e.displayName&&F.includes("<anonymous>")&&(F=F.replace("<anonymous>",e.displayName)),typeof e=="function"&&t.set(e,F),F}while(j>=1&&T>=0);break}}}finally{me=!1,de.current=E,Oe(),Error.prepareStackTrace=b}var ae=e?e.displayName||e.name:"",$=ae?te(ae):"";return typeof e=="function"&&t.set(e,$),$}function c(e,n,r){return u(e,!1)}function a(e){var n=e.prototype;return!!(n&&n.isReactComponent)}function l(e,n,r){if(e==null)return"";if(typeof e=="function")return u(e,a(e));if(typeof e=="string")return te(e);switch(e){case L:return te("Suspense");case O:return te("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case _:return c(e.render);case C:return l(e.type,n,r);case U:{var f=e,b=f._payload,E=f._init;try{return l(E(b),n,r)}catch{}}}return""}var d=Object.prototype.hasOwnProperty,N={},Q=J.ReactDebugCurrentFrame;function B(e){if(e){var n=e._owner,r=l(e.type,e._source,n?n.type:null);Q.setExtraStackFrame(r)}else Q.setExtraStackFrame(null)}function z(e,n,r,f,b){{var E=Function.call.bind(d);for(var h in e)if(E(e,h)){var v=void 0;try{if(typeof e[h]!="function"){var k=Error((f||"React class")+": "+r+" type `"+h+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[h]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw k.name="Invariant Violation",k}v=e[h](n,h,f,r,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(j){v=j}v&&!(v instanceof Error)&&(B(b),R("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",f||"React class",r,h,typeof v),B(null)),v instanceof Error&&!(v.message in N)&&(N[v.message]=!0,B(b),R("Failed %s type: %s",r,v.message),B(null))}}}var ke=Array.isArray;function ne(e){return ke(e)}function pt(e){{var n=typeof Symbol=="function"&&Symbol.toStringTag,r=n&&e[Symbol.toStringTag]||e.constructor.name||"Object";return r}}function vt(e){try{return Ge(e),!1}catch{return!0}}function Ge(e){return""+e}function ze(e){if(vt(e))return R("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",pt(e)),Ge(e)}var Xe=J.ReactCurrentOwner,ht={key:!0,ref:!0,__self:!0,__source:!0},He,Ke;function gt(e){if(d.call(e,"ref")){var n=Object.getOwnPropertyDescriptor(e,"ref").get;if(n&&n.isReactWarning)return!1}return e.ref!==void 0}function bt(e){if(d.call(e,"key")){var n=Object.getOwnPropertyDescriptor(e,"key").get;if(n&&n.isReactWarning)return!1}return e.key!==void 0}function yt(e,n){typeof e.ref=="string"&&Xe.current}function Et(e,n){{var r=function(){He||(He=!0,R("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",n))};r.isReactWarning=!0,Object.defineProperty(e,"key",{get:r,configurable:!0})}}function _t(e,n){{var r=function(){Ke||(Ke=!0,R("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",n))};r.isReactWarning=!0,Object.defineProperty(e,"ref",{get:r,configurable:!0})}}var xt=function(e,n,r,f,b,E,h){var v={$$typeof:p,type:e,key:n,ref:r,props:h,_owner:E};return v._store={},Object.defineProperty(v._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(v,"_self",{configurable:!1,enumerable:!1,writable:!1,value:f}),Object.defineProperty(v,"_source",{configurable:!1,enumerable:!1,writable:!1,value:b}),Object.freeze&&(Object.freeze(v.props),Object.freeze(v)),v};function St(e,n,r,f,b){{var E,h={},v=null,k=null;r!==void 0&&(ze(r),v=""+r),bt(n)&&(ze(n.key),v=""+n.key),gt(n)&&(k=n.ref,yt(n,b));for(E in n)d.call(n,E)&&!ht.hasOwnProperty(E)&&(h[E]=n[E]);if(e&&e.defaultProps){var j=e.defaultProps;for(E in j)h[E]===void 0&&(h[E]=j[E])}if(v||k){var T=typeof e=="function"?e.displayName||e.name||"Unknown":e;v&&Et(h,T),k&&_t(h,T)}return xt(e,v,k,b,f,Xe.current,h)}}var Pe=J.ReactCurrentOwner,Ze=J.ReactDebugCurrentFrame;function re(e){if(e){var n=e._owner,r=l(e.type,e._source,n?n.type:null);Ze.setExtraStackFrame(r)}else Ze.setExtraStackFrame(null)}var Le;Le=!1;function Fe(e){return typeof e=="object"&&e!==null&&e.$$typeof===p}function Qe(){{if(Pe.current){var e=w(Pe.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function jt(e){return""}var $e={};function Rt(e){{var n=Qe();if(!n){var r=typeof e=="string"?e:e.displayName||e.name;r&&(n=`

Check the top-level render call using <`+r+">.")}return n}}function qe(e,n){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var r=Rt(n);if($e[r])return;$e[r]=!0;var f="";e&&e._owner&&e._owner!==Pe.current&&(f=" It was passed a child from "+w(e._owner.type)+"."),re(e),R('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',r,f),re(null)}}function et(e,n){{if(typeof e!="object")return;if(ne(e))for(var r=0;r<e.length;r++){var f=e[r];Fe(f)&&qe(f,n)}else if(Fe(e))e._store&&(e._store.validated=!0);else if(e){var b=ee(e);if(typeof b=="function"&&b!==e.entries)for(var E=b.call(e),h;!(h=E.next()).done;)Fe(h.value)&&qe(h.value,n)}}}function Tt(e){{var n=e.type;if(n==null||typeof n=="string")return;var r;if(typeof n=="function")r=n.propTypes;else if(typeof n=="object"&&(n.$$typeof===_||n.$$typeof===C))r=n.propTypes;else return;if(r){var f=w(n);z(r,e.props,"prop",f,e)}else if(n.PropTypes!==void 0&&!Le){Le=!0;var b=w(n);R("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",b||"Unknown")}typeof n.getDefaultProps=="function"&&!n.getDefaultProps.isReactClassApproved&&R("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function wt(e){{for(var n=Object.keys(e.props),r=0;r<n.length;r++){var f=n[r];if(f!=="children"&&f!=="key"){re(e),R("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",f),re(null);break}}e.ref!==null&&(re(e),R("Invalid attribute `ref` supplied to `React.Fragment`."),re(null))}}var tt={};function nt(e,n,r,f,b,E){{var h=ge(e);if(!h){var v="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(v+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var k=jt();k?v+=k:v+=Qe();var j;e===null?j="null":ne(e)?j="array":e!==void 0&&e.$$typeof===p?(j="<"+(w(e.type)||"Unknown")+" />",v=" Did you accidentally export a JSX literal instead of a component?"):j=typeof e,R("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",j,v)}var T=St(e,n,r,b,E);if(T==null)return T;if(h){var F=n.children;if(F!==void 0)if(f)if(ne(F)){for(var ae=0;ae<F.length;ae++)et(F[ae],e);Object.freeze&&Object.freeze(F)}else R("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else et(F,e)}if(d.call(n,"key")){var $=w(e),P=Object.keys(n).filter(function(Pt){return Pt!=="key"}),Ae=P.length>0?"{key: someKey, "+P.join(": ..., ")+": ...}":"{key: someKey}";if(!tt[$+Ae]){var kt=P.length>0?"{"+P.join(": ..., ")+": ...}":"{}";R(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Ae,$,kt,$),tt[$+Ae]=!0}}return e===g?wt(T):Tt(T),T}}function Ct(e,n,r){return nt(e,n,r,!0)}function Nt(e,n,r){return nt(e,n,r,!1)}var Dt=Nt,Ot=Ct;oe.Fragment=g,oe.jsx=Dt,oe.jsxs=Ot}()),oe}process.env.NODE_ENV==="production"?je.exports=rt():je.exports=at();var s=je.exports;const st="/api/imu/latest",Ye=12,ot=1e3,Ue="dodec-labels",We="dodec-activity-log",it="Side",lt=24*60*60*1e3,Ve=Array.from({length:Ye},(i,p)=>p+1),Re=()=>{const i={};for(const p of Ve)i[p]="";return i},Te=(i,p)=>{var g;const y=(g=i[p])==null?void 0:g.trim();return y&&y.length>0?y:`${it} ${p}`},ct=i=>{const p=[i.received_at,i.imu_timestamp_iso];for(const y of p)if(y){const g=Date.parse(y);if(!Number.isNaN(g))return g}if(i.imu_timestamp_text){const y=i.imu_timestamp_text.replace(" ","T"),g=Date.parse(y);if(!Number.isNaN(g))return g}return Date.now()},q=i=>{const p=new Date(i),y=p.getFullYear(),g=String(p.getMonth()+1).padStart(2,"0"),x=String(p.getDate()).padStart(2,"0");return`${y}-${g}-${x}`},ie=i=>{const[p,y,g]=i.split("-").map(Number);return new Date(p,y-1,g)},pe=i=>{const p=ie(i),y=new Date(p.getFullYear(),p.getMonth(),p.getDate()).getTime(),g=y+lt;return{start:y,end:g}},Be=i=>{const p=ie(i);return new Intl.DateTimeFormat(void 0,{dateStyle:"medium"}).format(p)},ut=i=>i?i.replace("T"," ").replace(/\+.*$/,""):"Waiting for data?",le=i=>{if(!Number.isFinite(i)||i<=0)return"00:00";const p=Math.floor(i/1e3),y=Math.floor(p/3600),g=Math.floor(p%3600/60),x=p%60;return y>0?`${String(y).padStart(2,"0")}:${String(g).padStart(2,"0")}:${String(x).padStart(2,"0")}`:`${String(g).padStart(2,"0")}:${String(x).padStart(2,"0")}`},ft=i=>le(i),dt=i=>{const p=i.trim();if(!p)return NaN;const y=p.split(":");if(y.length>1){if(y.length>3)return NaN;const x=y.map(_=>Number(_));if(x.some(_=>Number.isNaN(_)||_<0))return NaN;let A=0,S=0,D=0;return x.length===3?[A,S,D]=x:[S,D]=x,Math.max(0,A*3600+S*60+D)*1e3}const g=Number(p);return Number.isNaN(g)||g<0?NaN:g*60*1e3},Je=i=>i.includes('"')||i.includes(",")||i.includes(`
`)?`"${i.replace(/"/g,'""')}"`:i;function mt(){const[i,p]=m.useState(null),[y,g]=m.useState(null),[x,A]=m.useState(()=>{if(typeof window>"u")return{};try{const t=window.localStorage.getItem(We);return t?JSON.parse(t):{}}catch(t){return console.warn("Unable to read stored activity log",t),{}}}),[S,D]=m.useState(null),[_,L]=m.useState(""),[O,C]=m.useState(null),[U,H]=m.useState(()=>[q(Date.now())]),[M,we]=m.useState("week"),[ee,J]=m.useState(q(Date.now())),[R,Ce]=m.useState(q(Date.now())),[ve,ce]=m.useState(null),[I,Ne]=m.useState(()=>{if(typeof window>"u")return Re();try{const t=window.localStorage.getItem(Ue);if(t){const o=JSON.parse(t),u=Re();for(const[c,a]of Object.entries(o)){const l=Number(c);Number.isFinite(l)&&l>=1&&l<=Ye&&(u[l]=String(a))}return u}}catch(t){console.warn("Unable to read stored labels",t)}return Re()}),he=m.useRef(I),Y=m.useRef({currentLabel:null,startTime:null,lastTimestamp:null,lastSide:null}),ge=m.useCallback((t,o,u)=>{u<=o||A(c=>{const a={...c};let l=o;for(;l<u;){const d=q(l),{end:N}=pe(d),Q=Math.min(u,N),B=Math.max(0,Q-l);if(B>0){const z={...a[d]??{}};z[t]=(z[t]??0)+B,a[d]=z}l=Q}return a})},[]),be=m.useCallback(t=>{const o=typeof t.side=="number"?t.side:null;if(!o)return;const u=Te(he.current,o),c=ct(t),a=Y.current;if(a.currentLabel===null||a.startTime===null){a.currentLabel=u,a.startTime=c,a.lastTimestamp=c,a.lastSide=o;return}if(u===a.currentLabel){a.lastTimestamp=c,a.lastSide=o;return}const l=a.startTime,d=c;d>l&&ge(a.currentLabel,l,d),a.currentLabel=u,a.startTime=c,a.lastTimestamp=c,a.lastSide=o},[ge]);m.useEffect(()=>{he.current=I,typeof window<"u"&&window.localStorage.setItem(Ue,JSON.stringify(I));const t=Y.current;t.lastSide!==null&&(t.currentLabel=Te(I,t.lastSide))},[I]),m.useEffect(()=>{typeof window<"u"&&window.localStorage.setItem(We,JSON.stringify(x))},[x]),m.useEffect(()=>{let t=!0;const o=async()=>{try{const c=await fetch(st,{cache:"no-store"});if(!c.ok)throw new Error(`Request failed with status ${c.status}`);const a=await c.json();if(!t)return;be(a),p({side:typeof a.side=="number"?a.side:null,imu_timestamp_text:a.imu_timestamp_text??null,imu_timestamp_iso:a.imu_timestamp_iso??null,received_at:a.received_at??null,confidence:a.confidence??null}),g(null)}catch(c){t&&g(c instanceof Error?c.message:"Unknown error")}};o();const u=window.setInterval(o,ot);return()=>{t=!1,window.clearInterval(u)}},[be]);const ue=Y.current,w=ue.lastTimestamp?q(ue.lastTimestamp):q(Date.now());m.useEffect(()=>{H(t=>t.includes(w)?t:[...t,w])},[w]);const W=m.useCallback(t=>o=>{const u=o.target.value;Ne(c=>({...c,[t]:u}))},[]),V=(t,o)=>{const u=Y.current;if(!u.currentLabel||u.currentLabel!==o||u.startTime===null||u.lastTimestamp===null)return 0;const{start:c,end:a}=pe(t),l=Math.max(c,u.startTime),d=Math.min(a,u.lastTimestamp);return d>l?d-l:0},K=m.useCallback(t=>{const o=x[t]??{},u=Object.entries(o).map(([a,l])=>({label:a,totalMs:l})),c=Y.current;if(c.currentLabel&&c.startTime!==null&&c.lastTimestamp!==null){const a=V(t,c.currentLabel);if(a>0){const l=u.find(d=>d.label===c.currentLabel);l?l.totalMs+=a:u.push({label:c.currentLabel,totalMs:a})}}return u.sort((a,l)=>l.totalMs-a.totalMs)},[x,i]),Z=m.useMemo(()=>{const t=new Set(Object.keys(x));return t.add(w),Array.from(t).sort((o,u)=>o===u?0:o>u?-1:1)},[x,w]),fe=m.useMemo(()=>Z.map(t=>{const o=K(t);if(o.length===0)return null;const u=o.reduce((c,a)=>c+a.totalMs,0);return{dateKey:t,rows:o,totalMs:u}}).filter(Boolean),[Z,K]),ye=m.useCallback((t,o,u)=>{if(Y.current.currentLabel===o&&t===w){C("Stop the current activity before editing it.");return}D({dateKey:t,label:o}),L(ft(u)),C(null)},[w]),Ee=m.useCallback(t=>{L(t.target.value)},[]),_e=m.useCallback(()=>{D(null),L(""),C(null)},[]),xe=m.useCallback(()=>{if(!S)return;const{dateKey:t,label:o}=S,u=dt(_);if(!Number.isFinite(u)){C("Please enter duration as mm:ss, hh:mm:ss, or minutes.");return}const c=V(t,o);if(u<c){C(`Duration cannot be less than the active segment (${le(c)}).`);return}const a=Math.max(0,u-c);A(l=>{const d={...l},N={...d[t]??{}};return a<=0?delete N[o]:N[o]=a,Object.keys(N).length===0?delete d[t]:d[t]=N,d}),D(null),L(""),C(null)},[S,_]),Se=m.useCallback((t,o)=>{if(V(t,o)>0){C("Stop the current activity before deleting it.");return}A(c=>{const a=c[t];if(!a||!(o in a))return c;const l={...c},d={...a};return delete d[o],Object.keys(d).length===0?delete l[t]:l[t]=d,l}),S&&S.dateKey===t&&S.label===o&&(D(null),L("")),C(null)},[S]),De=m.useCallback(t=>{H(o=>o.includes(t)?o.filter(u=>u!==t):[...o,t])},[]),Oe=()=>{if(M==="week"){const{start:a,end:l}=pe(w),d=new Date(a);return d.setDate(d.getDate()-6),{start:new Date(d.getFullYear(),d.getMonth(),d.getDate()).getTime(),end:l}}if(M==="month"){const a=ie(w),l=new Date(a.getFullYear(),a.getMonth(),1).getTime(),d=new Date(a.getFullYear(),a.getMonth()+1,1).getTime();return{start:l,end:d}}const t=ie(ee),o=ie(R);if(Number.isNaN(t.getTime())||Number.isNaN(o.getTime())||t>o)return null;const u=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime(),c=new Date(o.getFullYear(),o.getMonth(),o.getDate()+1).getTime();return{start:u,end:c}},de=m.useCallback(()=>{const t=Oe();if(!t){ce("Please provide a valid date range before downloading.");return}const o=[];for(const N of Z){const{start:Q,end:B}=pe(N);if(B<=t.start||Q>=t.end)continue;const z=K(N);if(z.length===0)continue;const ke=Be(N);for(const ne of z)o.push(`${Je(ke)},${Je(ne.label)},${le(ne.totalMs)}`)}if(o.length===0){ce("No activity recorded in the selected range.");return}const u=["Date,Activity,Duration",...o].join(`
`),c=new Blob([u],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(c),l=document.createElement("a");l.href=a;const d=M==="custom"?"custom":M;l.download=`activity-log-${d}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a),ce(null)},[K,M,Z,ee,R]),G=(i==null?void 0:i.side)??null,te=m.useMemo(()=>G===null?null:Te(I,G),[G,I]),me=(i==null?void 0:i.imu_timestamp_text)??(i==null?void 0:i.imu_timestamp_iso)??(i==null?void 0:i.received_at)??null;return s.jsxs("div",{className:"app-shell",children:[s.jsxs("header",{className:"app-header",children:[s.jsx("h1",{children:"Do-Decahedron Orientation"}),s.jsxs("p",{className:"status-line",children:[s.jsx("span",{className:"status-label",children:"Latest IMU update:"}),s.jsx("span",{className:"status-value",children:ut(me)})]}),s.jsxs("p",{className:"status-line",children:[s.jsx("span",{className:"status-label",children:"Current activity:"}),s.jsx("span",{className:"status-value",children:te??"Waiting for data?"})]}),y?s.jsxs("p",{className:"error-text",children:["Error: ",y]}):null]}),s.jsx("section",{className:"side-list","aria-label":"Side configuration",children:Ve.map(t=>{const o=t===G;return s.jsxs("div",{className:"side-row",children:[s.jsxs("div",{className:`side-card${o?" side-card--active":""}`,children:[s.jsx("span",{className:"side-number",children:t}),s.jsx("span",{className:"side-label",children:"Side"})]}),s.jsx("input",{type:"text",className:"activity-input",value:I[t]??"",placeholder:`Label for side ${t}`,onChange:W(t)})]},t)})}),s.jsxs("section",{className:"activity-summary","aria-live":"polite",children:[s.jsx("h2",{children:"Activity Log"}),s.jsxs("div",{className:"range-controls",children:[s.jsxs("label",{className:"range-option",children:["Range",s.jsxs("select",{className:"range-select",value:M,onChange:t=>we(t.target.value),children:[s.jsx("option",{value:"week",children:"This week"}),s.jsx("option",{value:"month",children:"This month"}),s.jsx("option",{value:"custom",children:"Custom"})]})]}),M==="custom"?s.jsxs(s.Fragment,{children:[s.jsxs("label",{className:"range-option",children:["From",s.jsx("input",{type:"date",className:"date-input",value:ee,max:R,onChange:t=>J(t.target.value)})]}),s.jsxs("label",{className:"range-option",children:["To",s.jsx("input",{type:"date",className:"date-input",value:R,min:ee,onChange:t=>Ce(t.target.value)})]})]}):null,s.jsx("button",{type:"button",className:"download-button",onClick:de,children:"Download CSV"})]}),ve?s.jsx("p",{className:"error-text",children:ve}):null,fe.length===0?s.jsx("p",{className:"placeholder-text",children:"No activity recorded yet."}):fe.map(({dateKey:t,rows:o,totalMs:u})=>{const c=U.includes(t),a=Y.current;return s.jsxs("div",{className:"date-group",children:[s.jsxs("button",{type:"button",className:`date-header${c?" date-header--expanded":""}`,onClick:()=>De(t),children:[s.jsxs("div",{className:"date-header__title",children:[s.jsx("span",{className:"date-label",children:Be(t)}),s.jsxs("span",{className:"date-summary",children:[o.length," activit",o.length===1?"y":"ies"," - ",le(u)]})]}),s.jsx("span",{className:"date-header__icon",children:c?"−":"+"})]}),c?s.jsxs("table",{className:"activity-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{scope:"col",children:"Activity"}),s.jsx("th",{scope:"col",children:"Total Duration"}),s.jsx("th",{scope:"col",className:"actions-heading",children:"Actions"})]})}),s.jsx("tbody",{children:o.map(l=>{const d=(S==null?void 0:S.dateKey)===t&&S.label===l.label,N=a.currentLabel===l.label&&t===w;return s.jsxs("tr",{children:[s.jsx("td",{children:l.label}),s.jsx("td",{children:d?s.jsx("input",{type:"text",className:"duration-input",value:_,onChange:Ee,placeholder:"mm:ss or hh:mm:ss"}):s.jsx("span",{children:le(l.totalMs)})}),s.jsx("td",{className:"actions-cell",children:s.jsx("div",{className:"action-buttons",children:d?s.jsxs(s.Fragment,{children:[s.jsx("button",{type:"button",className:"icon-button icon-button--primary",onClick:xe,children:"Save"}),s.jsx("button",{type:"button",className:"icon-button",onClick:_e,children:"Cancel"})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{type:"button",className:"icon-button",disabled:N,onClick:()=>ye(t,l.label,l.totalMs),children:"Edit"}),s.jsx("button",{type:"button",className:"icon-button icon-button--danger",disabled:N,onClick:()=>Se(t,l.label),children:"Delete"})]})})})]},`${t}-${l.label}`)})})]}):null]},t)}),O?s.jsx("p",{className:"error-text",children:O}):null]})]})}X.TimesheetDevice=mt,Object.defineProperty(X,Symbol.toStringTag,{value:"Module"})});
