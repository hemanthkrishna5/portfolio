(function(K,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],d):(K=typeof globalThis<"u"?globalThis:K||self,d(K.TimesheetDeviceUI={},K.React))})(this,function(K,d){"use strict";var Ne={exports:{}},le={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ze;function ct(){if(ze)return le;ze=1;var l=d,p=Symbol.for("react.element"),b=Symbol.for("react.fragment"),m=Object.prototype.hasOwnProperty,w=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,O={key:!0,ref:!0,__self:!0,__source:!0};function S(D,E,F){var N,k={},V=null,P=null;F!==void 0&&(V=""+F),E.key!==void 0&&(V=""+E.key),E.ref!==void 0&&(P=E.ref);for(N in E)m.call(E,N)&&!O.hasOwnProperty(N)&&(k[N]=E[N]);if(D&&D.defaultProps)for(N in E=D.defaultProps,E)k[N]===void 0&&(k[N]=E[N]);return{$$typeof:p,type:D,key:V,ref:P,props:k,_owner:w.current}}return le.Fragment=b,le.jsx=S,le.jsxs=S,le}var ce={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var He;function ut(){return He||(He=1,process.env.NODE_ENV!=="production"&&function(){var l=d,p=Symbol.for("react.element"),b=Symbol.for("react.portal"),m=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),O=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),D=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),P=Symbol.for("react.offscreen"),xe=Symbol.iterator,Re="@@iterator";function B(e){if(e===null||typeof e!="object")return null;var n=xe&&e[xe]||e[Re];return typeof n=="function"?n:null}var z=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function R(e){{for(var n=arguments.length,a=new Array(n>1?n-1:0),f=1;f<n;f++)a[f-1]=arguments[f];Me("error",e,a)}}function Me(e,n,a){{var f=z.ReactDebugCurrentFrame,y=f.getStackAddendum();y!==""&&(n+="%s",a=a.concat([y]));var _=a.map(function(g){return String(g)});_.unshift("Warning: "+n),Function.prototype.apply.call(console[e],console,_)}}var ne=!1,Fe=!1,Te=!1,de=!1,W=!1,me;me=Symbol.for("react.module.reference");function pe(e){return!!(typeof e=="string"||typeof e=="function"||e===m||e===O||W||e===w||e===F||e===N||de||e===P||ne||Fe||Te||typeof e=="object"&&e!==null&&(e.$$typeof===V||e.$$typeof===k||e.$$typeof===S||e.$$typeof===D||e.$$typeof===E||e.$$typeof===me||e.getModuleId!==void 0))}function ve(e,n,a){var f=e.displayName;if(f)return f;var y=n.displayName||n.name||"";return y!==""?a+"("+y+")":a}function Y(e){return e.displayName||"Context"}function U(e){if(e==null)return null;if(typeof e.tag=="number"&&R("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case m:return"Fragment";case b:return"Portal";case O:return"Profiler";case w:return"StrictMode";case F:return"Suspense";case N:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case D:var n=e;return Y(n)+".Consumer";case S:var a=e;return Y(a._context)+".Provider";case E:return ve(e,e.render,"ForwardRef");case k:var f=e.displayName||null;return f!==null?f:U(e.type)||"Memo";case V:{var y=e,_=y._payload,g=y._init;try{return U(g(_))}catch{return null}}}return null}var J=Object.assign,H=0,he,X,ge,M,Q,Z,q;function be(){}be.__reactDisabledLog=!0;function Ie(){{if(H===0){he=console.log,X=console.info,ge=console.warn,M=console.error,Q=console.group,Z=console.groupCollapsed,q=console.groupEnd;var e={configurable:!0,enumerable:!0,value:be,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}H++}}function Ye(){{if(H--,H===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:J({},e,{value:he}),info:J({},e,{value:X}),warn:J({},e,{value:ge}),error:J({},e,{value:M}),group:J({},e,{value:Q}),groupCollapsed:J({},e,{value:Z}),groupEnd:J({},e,{value:q})})}H<0&&R("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var ye=z.ReactCurrentDispatcher,Ee;function re(e,n,a){{if(Ee===void 0)try{throw Error()}catch(y){var f=y.stack.trim().match(/\n( *(at )?)/);Ee=f&&f[1]||""}return`
`+Ee+e}}var _e=!1,ae;{var Ue=typeof WeakMap=="function"?WeakMap:Map;ae=new Ue}function je(e,n){if(!e||_e)return"";{var a=ae.get(e);if(a!==void 0)return a}var f;_e=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var _;_=ye.current,ye.current=null,Ie();try{if(n){var g=function(){throw Error()};if(Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(A){f=A}Reflect.construct(e,[],g)}else{try{g.call()}catch(A){f=A}e.call(g.prototype)}}else{try{throw Error()}catch(A){f=A}e()}}catch(A){if(A&&f&&typeof A.stack=="string"){for(var h=A.stack.split(`
`),L=f.stack.split(`
`),x=h.length-1,T=L.length-1;x>=1&&T>=0&&h[x]!==L[T];)T--;for(;x>=1&&T>=0;x--,T--)if(h[x]!==L[T]){if(x!==1||T!==1)do if(x--,T--,T<0||h[x]!==L[T]){var I=`
`+h[x].replace(" at new "," at ");return e.displayName&&I.includes("<anonymous>")&&(I=I.replace("<anonymous>",e.displayName)),typeof e=="function"&&ae.set(e,I),I}while(x>=1&&T>=0);break}}}finally{_e=!1,ye.current=_,Ye(),Error.prepareStackTrace=y}var ie=e?e.displayName||e.name:"",ee=ie?re(ie):"";return typeof e=="function"&&ae.set(e,ee),ee}function we(e,n,a){return je(e,!1)}function Ve(e){var n=e.prototype;return!!(n&&n.isReactComponent)}function se(e,n,a){if(e==null)return"";if(typeof e=="function")return je(e,Ve(e));if(typeof e=="string")return re(e);switch(e){case F:return re("Suspense");case N:return re("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case E:return we(e.render);case k:return se(e.type,n,a);case V:{var f=e,y=f._payload,_=f._init;try{return se(_(y),n,a)}catch{}}}return""}var t=Object.prototype.hasOwnProperty,s={},o=z.ReactDebugCurrentFrame;function c(e){if(e){var n=e._owner,a=se(e.type,e._source,n?n.type:null);o.setExtraStackFrame(a)}else o.setExtraStackFrame(null)}function r(e,n,a,f,y){{var _=Function.call.bind(t);for(var g in e)if(_(e,g)){var h=void 0;try{if(typeof e[g]!="function"){var L=Error((f||"React class")+": "+a+" type `"+g+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[g]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw L.name="Invariant Violation",L}h=e[g](n,g,f,a,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(x){h=x}h&&!(h instanceof Error)&&(c(y),R("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",f||"React class",a,g,typeof h),c(null)),h instanceof Error&&!(h.message in s)&&(s[h.message]=!0,c(y),R("Failed %s type: %s",a,h.message),c(null))}}}var u=Array.isArray;function v(e){return u(e)}function j(e){{var n=typeof Symbol=="function"&&Symbol.toStringTag,a=n&&e[Symbol.toStringTag]||e.constructor.name||"Object";return a}}function C(e){try{return $(e),!1}catch{return!0}}function $(e){return""+e}function G(e){if(C(e))return R("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",j(e)),$(e)}var De=z.ReactCurrentOwner,Ce={key:!0,ref:!0,__self:!0,__source:!0},et,tt;function St(e){if(t.call(e,"ref")){var n=Object.getOwnPropertyDescriptor(e,"ref").get;if(n&&n.isReactWarning)return!1}return e.ref!==void 0}function xt(e){if(t.call(e,"key")){var n=Object.getOwnPropertyDescriptor(e,"key").get;if(n&&n.isReactWarning)return!1}return e.key!==void 0}function Rt(e,n){typeof e.ref=="string"&&De.current}function Tt(e,n){{var a=function(){et||(et=!0,R("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",n))};a.isReactWarning=!0,Object.defineProperty(e,"key",{get:a,configurable:!0})}}function jt(e,n){{var a=function(){tt||(tt=!0,R("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",n))};a.isReactWarning=!0,Object.defineProperty(e,"ref",{get:a,configurable:!0})}}var Dt=function(e,n,a,f,y,_,g){var h={$$typeof:p,type:e,key:n,ref:a,props:g,_owner:_};return h._store={},Object.defineProperty(h._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(h,"_self",{configurable:!1,enumerable:!1,writable:!1,value:f}),Object.defineProperty(h,"_source",{configurable:!1,enumerable:!1,writable:!1,value:y}),Object.freeze&&(Object.freeze(h.props),Object.freeze(h)),h};function Ct(e,n,a,f,y){{var _,g={},h=null,L=null;a!==void 0&&(G(a),h=""+a),xt(n)&&(G(n.key),h=""+n.key),St(n)&&(L=n.ref,Rt(n,y));for(_ in n)t.call(n,_)&&!Ce.hasOwnProperty(_)&&(g[_]=n[_]);if(e&&e.defaultProps){var x=e.defaultProps;for(_ in x)g[_]===void 0&&(g[_]=x[_])}if(h||L){var T=typeof e=="function"?e.displayName||e.name||"Unknown":e;h&&Tt(g,T),L&&jt(g,T)}return Dt(e,h,L,y,f,De.current,g)}}var We=z.ReactCurrentOwner,nt=z.ReactDebugCurrentFrame;function oe(e){if(e){var n=e._owner,a=se(e.type,e._source,n?n.type:null);nt.setExtraStackFrame(a)}else nt.setExtraStackFrame(null)}var Be;Be=!1;function Je(e){return typeof e=="object"&&e!==null&&e.$$typeof===p}function rt(){{if(We.current){var e=U(We.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function Nt(e){return""}var at={};function Ot(e){{var n=rt();if(!n){var a=typeof e=="string"?e:e.displayName||e.name;a&&(n=`

Check the top-level render call using <`+a+">.")}return n}}function st(e,n){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var a=Ot(n);if(at[a])return;at[a]=!0;var f="";e&&e._owner&&e._owner!==We.current&&(f=" It was passed a child from "+U(e._owner.type)+"."),oe(e),R('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',a,f),oe(null)}}function ot(e,n){{if(typeof e!="object")return;if(v(e))for(var a=0;a<e.length;a++){var f=e[a];Je(f)&&st(f,n)}else if(Je(e))e._store&&(e._store.validated=!0);else if(e){var y=B(e);if(typeof y=="function"&&y!==e.entries)for(var _=y.call(e),g;!(g=_.next()).done;)Je(g.value)&&st(g.value,n)}}}function kt(e){{var n=e.type;if(n==null||typeof n=="string")return;var a;if(typeof n=="function")a=n.propTypes;else if(typeof n=="object"&&(n.$$typeof===E||n.$$typeof===k))a=n.propTypes;else return;if(a){var f=U(n);r(a,e.props,"prop",f,e)}else if(n.PropTypes!==void 0&&!Be){Be=!0;var y=U(n);R("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",y||"Unknown")}typeof n.getDefaultProps=="function"&&!n.getDefaultProps.isReactClassApproved&&R("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Lt(e){{for(var n=Object.keys(e.props),a=0;a<n.length;a++){var f=n[a];if(f!=="children"&&f!=="key"){oe(e),R("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",f),oe(null);break}}e.ref!==null&&(oe(e),R("Invalid attribute `ref` supplied to `React.Fragment`."),oe(null))}}var it={};function lt(e,n,a,f,y,_){{var g=pe(e);if(!g){var h="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(h+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var L=Nt();L?h+=L:h+=rt();var x;e===null?x="null":v(e)?x="array":e!==void 0&&e.$$typeof===p?(x="<"+(U(e.type)||"Unknown")+" />",h=" Did you accidentally export a JSX literal instead of a component?"):x=typeof e,R("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",x,h)}var T=Ct(e,n,a,y,_);if(T==null)return T;if(g){var I=n.children;if(I!==void 0)if(f)if(v(I)){for(var ie=0;ie<I.length;ie++)ot(I[ie],e);Object.freeze&&Object.freeze(I)}else R("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ot(I,e)}if(t.call(n,"key")){var ee=U(e),A=Object.keys(n).filter(function(Yt){return Yt!=="key"}),Ge=A.length>0?"{key: someKey, "+A.join(": ..., ")+": ...}":"{key: someKey}";if(!it[ee+Ge]){var It=A.length>0?"{"+A.join(": ..., ")+": ...}":"{}";R(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Ge,ee,It,ee),it[ee+Ge]=!0}}return e===m?Lt(T):kt(T),T}}function Pt(e,n,a){return lt(e,n,a,!0)}function At(e,n,a){return lt(e,n,a,!1)}var Mt=At,Ft=Pt;ce.Fragment=m,ce.jsx=Mt,ce.jsxs=Ft}()),ce}process.env.NODE_ENV==="production"?Ne.exports=ct():Ne.exports=ut();var i=Ne.exports;const ft="/api/imu/latest",dt="/api/imu/history",Oe=12,mt=1e3,ke="dodec-labels",Ke=["dodeca-labels"],Xe="dodec-activity-log",pt="Side",vt=24*60*60*1e3,Le="DODEC_LABEL_UPDATE",Qe="DODEC_LABELS_REQUEST",ht=Array.from({length:Oe},(l,p)=>p+1),Pe=()=>{const l={};for(const p of ht)l[p]="";return l},gt=()=>{if(typeof window>"u")return Pe();const l=b=>{try{const m=window.localStorage.getItem(b);if(!m)return null;const w=JSON.parse(m),O=Pe();for(const[S,D]of Object.entries(w)){const E=Number(S);Number.isFinite(E)&&E>=1&&E<=Oe&&(O[E]=String(D??""))}return O}catch(m){return console.warn("Unable to read stored labels",m),null}},p=l(ke);if(p)return p;for(const b of Ke){const m=l(b);if(m){try{window.localStorage.setItem(ke,JSON.stringify(m))}catch{}return m}}return Pe()},Ze=()=>({currentLabel:null,startTime:null,lastTimestamp:null,lastSide:null}),Ae=(l,p)=>{var m;const b=(m=l[p])==null?void 0:m.trim();return b&&b.length>0?b:`${pt} ${p}`},bt=l=>{const p=[l.received_at,l.imu_timestamp_iso];for(const b of p)if(b){const m=Date.parse(b);if(!Number.isNaN(m))return m}if(l.imu_timestamp_text){const b=l.imu_timestamp_text.replace(" ","T"),m=Date.parse(b);if(!Number.isNaN(m))return m}return Date.now()},te=l=>{const p=new Date(l),b=p.getFullYear(),m=String(p.getMonth()+1).padStart(2,"0"),w=String(p.getDate()).padStart(2,"0");return`${b}-${m}-${w}`},ue=l=>{const[p,b,m]=l.split("-").map(Number);return new Date(p,b-1,m)},Se=l=>{const p=ue(l),b=new Date(p.getFullYear(),p.getMonth(),p.getDate()).getTime(),m=b+vt;return{start:b,end:m}},qe=l=>{const p=ue(l);return new Intl.DateTimeFormat(void 0,{dateStyle:"medium"}).format(p)},yt=l=>l?l.replace("T"," ").replace(/\+.*$/,""):"Waiting for data?",fe=l=>{if(!Number.isFinite(l)||l<=0)return"00:00";const p=Math.floor(l/1e3),b=Math.floor(p/3600),m=Math.floor(p%3600/60),w=p%60;return b>0?`${String(b).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(w).padStart(2,"0")}`:`${String(m).padStart(2,"0")}:${String(w).padStart(2,"0")}`},Et=l=>fe(l),_t=l=>{const p=l.trim();if(!p)return NaN;const b=p.split(":");if(b.length>1){if(b.length>3)return NaN;const w=b.map(E=>Number(E));if(w.some(E=>Number.isNaN(E)||E<0))return NaN;let O=0,S=0,D=0;return w.length===3?[O,S,D]=w:[S,D]=w,Math.max(0,O*3600+S*60+D)*1e3}const m=Number(p);return Number.isNaN(m)||m<0?NaN:m*60*1e3},$e=l=>l.includes('"')||l.includes(",")||l.includes(`
`)?`"${l.replace(/"/g,'""')}"`:l;function wt(){const[l,p]=d.useState(null),[b,m]=d.useState(null),[w,O]=d.useState(()=>{if(typeof window>"u")return{};try{const t=window.localStorage.getItem(Xe);return t?JSON.parse(t):{}}catch(t){return console.warn("Unable to read stored activity log",t),{}}}),[S,D]=d.useState(null),[E,F]=d.useState(""),[N,k]=d.useState(""),[V,P]=d.useState(null),[xe,Re]=d.useState(()=>[te(Date.now())]),[B,z]=d.useState("week"),[R,Me]=d.useState(te(Date.now())),[ne,Fe]=d.useState(te(Date.now())),[Te,de]=d.useState(null),[W,me]=d.useState(()=>gt()),pe=d.useRef(W),ve=d.useRef(!1),Y=d.useRef(Ze()),[U,J]=d.useState(!1),H=d.useCallback((t,s,o)=>{o<=s||O(c=>{const r={...c};let u=s;for(;u<o;){const v=te(u),{end:j}=Se(v),C=Math.min(o,j),$=Math.max(0,C-u);if($>0){const G={...r[v]??{}};G[t]=(G[t]??0)+$,r[v]=G}u=C}return r})},[]),he=d.useCallback(()=>{Y.current=Ze(),O(()=>({}))},[]),X=d.useCallback(t=>{const s=typeof t.side=="number"?t.side:null;if(!s)return;const o=Ae(pe.current,s),c=bt(t),r=Y.current;if(r.currentLabel===null||r.startTime===null){r.currentLabel=o,r.startTime=c,r.lastTimestamp=c,r.lastSide=s;return}if(o===r.currentLabel){r.lastTimestamp=c,r.lastSide=s;return}const u=r.startTime,v=c;v>u&&H(r.currentLabel,u,v),r.currentLabel=o,r.startTime=c,r.lastTimestamp=c,r.lastSide=s},[H]);d.useEffect(()=>{if(pe.current=W,typeof window<"u"){const s=JSON.stringify(W);window.localStorage.setItem(ke,s);for(const o of Ke)window.localStorage.setItem(o,s);!ve.current&&window.parent&&window.parent!==window&&window.parent.postMessage({type:Le,labels:W},"*")}ve.current=!1;const t=Y.current;t.lastSide!==null&&(t.currentLabel=Ae(W,t.lastSide))},[W]),d.useEffect(()=>{typeof window<"u"&&window.localStorage.setItem(Xe,JSON.stringify(w))},[w]),d.useEffect(()=>{if(typeof window>"u")return;const t=s=>{const o=s==null?void 0:s.data;if(!(!o||typeof o!="object"))if(o.type===Le&&o.labels&&typeof o.labels=="object"){ve.current=!0;const c=o.labels;me(r=>{const u={...r};for(const[v,j]of Object.entries(c)){const C=Number(v);!Number.isFinite(C)||C<1||C>Oe||(u[C]=typeof j=="string"?j:"")}return{...u}})}else o.type===Qe&&window.parent&&window.parent!==window&&window.parent.postMessage({type:Le,labels:pe.current},s.origin||"*")};return window.addEventListener("message",t),window.parent&&window.parent!==window&&window.parent.postMessage({type:Qe},"*"),()=>{window.removeEventListener("message",t)}},[]),d.useEffect(()=>{let t=!1;return(async()=>{try{const o=await fetch(`${dt}?limit=5000`,{cache:"no-store"});if(!o.ok)throw new Error(`History request failed with status ${o.status}`);const c=await o.json();if(t)return;he();let r=null;for(const u of c){if(t)break;X(u),r=u}r&&p({side:typeof r.side=="number"?r.side:null,imu_timestamp_text:r.imu_timestamp_text??null,imu_timestamp_iso:r.imu_timestamp_iso??null,received_at:r.received_at??null,confidence:r.confidence??null}),m(null)}catch(o){t||m(o instanceof Error?o.message:"Unknown error while loading history")}finally{t||J(!0)}})(),()=>{t=!0}},[X,he]),d.useEffect(()=>{if(!U)return;let t=!0;const s=async()=>{try{const c=await fetch(ft,{cache:"no-store"});if(!c.ok)throw new Error(`Request failed with status ${c.status}`);const r=await c.json();if(!t)return;X(r),p({side:typeof r.side=="number"?r.side:null,imu_timestamp_text:r.imu_timestamp_text??null,imu_timestamp_iso:r.imu_timestamp_iso??null,received_at:r.received_at??null,confidence:r.confidence??null}),m(null)}catch(c){t&&m(c instanceof Error?c.message:"Unknown error")}};s();const o=window.setInterval(s,mt);return()=>{t=!1,window.clearInterval(o)}},[X,U]);const ge=Y.current,M=ge.lastTimestamp?te(ge.lastTimestamp):te(Date.now());d.useEffect(()=>{Re(t=>t.includes(M)?t:[...t,M])},[M]),d.useCallback(t=>s=>{const o=s.target.value;me(c=>({...c,[t]:o}))},[]);const Q=(t,s)=>{const o=Y.current;if(!o.currentLabel||o.currentLabel!==s||o.startTime===null||o.lastTimestamp===null)return 0;const{start:c,end:r}=Se(t),u=Math.max(c,o.startTime),v=Math.min(r,o.lastTimestamp);return v>u?v-u:0},Z=d.useCallback(t=>{const s=w[t]??{},o=Object.entries(s).map(([r,u])=>({label:r,totalMs:u})),c=Y.current;if(c.currentLabel&&c.startTime!==null&&c.lastTimestamp!==null){const r=Q(t,c.currentLabel);if(r>0){const u=o.find(v=>v.label===c.currentLabel);u?u.totalMs+=r:o.push({label:c.currentLabel,totalMs:r})}}return o.sort((r,u)=>u.totalMs-r.totalMs)},[w,l]),q=d.useMemo(()=>{const t=new Set(Object.keys(w));return t.add(M),Array.from(t).sort((s,o)=>s===o?0:s>o?-1:1)},[w,M]),be=d.useMemo(()=>q.map(t=>{const s=Z(t);if(s.length===0)return null;const o=s.reduce((c,r)=>c+r.totalMs,0);return{dateKey:t,rows:s,totalMs:o}}).filter(Boolean),[q,Z]),Ie=d.useCallback((t,s,o)=>{if(Y.current.currentLabel===s&&t===M){P("Stop the current activity before editing it.");return}D({dateKey:t,originalLabel:s}),F(Et(o)),k(s),P(null)},[M]),Ye=d.useCallback(t=>{F(t.target.value)},[]),ye=d.useCallback(t=>{k(t.target.value)},[]),Ee=d.useCallback(()=>{D(null),F(""),k(""),P(null)},[]),re=d.useCallback(()=>{if(!S)return;const{dateKey:t,originalLabel:s}=S,o=_t(E);if(!Number.isFinite(o)){P("Please enter duration as mm:ss, hh:mm:ss, or minutes.");return}const c=N.trim();if(c.length===0){P("Activity name cannot be empty.");return}const r=Q(t,s);if(o<r){P(`Duration cannot be less than the active segment (${fe(r)}).`);return}const u=Math.max(0,o-r);O(v=>{const j={...v},C={...j[t]??{}};return s in C&&delete C[s],u>0&&(C[c]=(C[c]??0)+u),Object.keys(C).length===0?delete j[t]:j[t]=C,j}),D(null),F(""),k(""),P(null)},[S,E,N,Q]),_e=d.useCallback((t,s)=>{if(Q(t,s)>0){P("Stop the current activity before deleting it.");return}O(c=>{const r=c[t];if(!r||!(s in r))return c;const u={...c},v={...r};return delete v[s],Object.keys(v).length===0?delete u[t]:u[t]=v,u}),S&&S.dateKey===t&&S.originalLabel===s&&(D(null),F(""),k("")),P(null)},[S]),ae=d.useCallback(t=>{Re(s=>s.includes(t)?s.filter(o=>o!==t):[...s,t])},[]),Ue=()=>{if(B==="week"){const{start:r,end:u}=Se(M),v=new Date(r);return v.setDate(v.getDate()-6),{start:new Date(v.getFullYear(),v.getMonth(),v.getDate()).getTime(),end:u}}if(B==="month"){const r=ue(M),u=new Date(r.getFullYear(),r.getMonth(),1).getTime(),v=new Date(r.getFullYear(),r.getMonth()+1,1).getTime();return{start:u,end:v}}const t=ue(R),s=ue(ne);if(Number.isNaN(t.getTime())||Number.isNaN(s.getTime())||t>s)return null;const o=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime(),c=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1).getTime();return{start:o,end:c}},je=d.useCallback(()=>{const t=Ue();if(!t){de("Please provide a valid date range before downloading.");return}const s=[];for(const j of q){const{start:C,end:$}=Se(j);if($<=t.start||C>=t.end)continue;const G=Z(j);if(G.length===0)continue;const De=qe(j);for(const Ce of G)s.push(`${$e(De)},${$e(Ce.label)},${fe(Ce.totalMs)}`)}if(s.length===0){de("No activity recorded in the selected range.");return}const o=["Date,Activity,Duration",...s].join(`
`),c=new Blob([o],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(c),u=document.createElement("a");u.href=r;const v=B==="custom"?"custom":B;u.download=`activity-log-${v}.csv`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(r),de(null)},[Z,B,q,R,ne]),we=(l==null?void 0:l.side)??null,Ve=d.useMemo(()=>we===null?null:Ae(W,we),[we,W]),se=(l==null?void 0:l.imu_timestamp_text)??(l==null?void 0:l.imu_timestamp_iso)??(l==null?void 0:l.received_at)??null;return i.jsxs("div",{className:"app-shell",children:[i.jsxs("header",{className:"app-header",children:[i.jsx("h1",{children:"Do-Decahedron Orientation"}),i.jsxs("p",{className:"status-line",children:[i.jsx("span",{className:"status-label",children:"Latest IMU update:"}),i.jsx("span",{className:"status-value",children:yt(se)})]}),i.jsxs("p",{className:"status-line",children:[i.jsx("span",{className:"status-label",children:"Current activity:"}),i.jsx("span",{className:"status-value",children:Ve??"Waiting for data?"})]}),b?i.jsxs("p",{className:"error-text",children:["Error: ",b]}):null]}),i.jsxs("section",{className:"activity-summary","aria-live":"polite",children:[i.jsx("h2",{children:"Activity Log"}),i.jsxs("div",{className:"range-controls",children:[i.jsxs("label",{className:"range-option",children:["Range",i.jsxs("select",{className:"range-select",value:B,onChange:t=>z(t.target.value),children:[i.jsx("option",{value:"week",children:"This week"}),i.jsx("option",{value:"month",children:"This month"}),i.jsx("option",{value:"custom",children:"Custom"})]})]}),B==="custom"?i.jsxs(i.Fragment,{children:[i.jsxs("label",{className:"range-option",children:["From",i.jsx("input",{type:"date",className:"date-input",value:R,max:ne,onChange:t=>Me(t.target.value)})]}),i.jsxs("label",{className:"range-option",children:["To",i.jsx("input",{type:"date",className:"date-input",value:ne,min:R,onChange:t=>Fe(t.target.value)})]})]}):null,i.jsx("button",{type:"button",className:"download-button",onClick:je,children:"Download CSV"})]}),Te?i.jsx("p",{className:"error-text",children:Te}):null,be.length===0?i.jsx("p",{className:"placeholder-text",children:"No activity recorded yet."}):be.map(({dateKey:t,rows:s,totalMs:o})=>{const c=xe.includes(t),r=Y.current;return i.jsxs("div",{className:"date-group",children:[i.jsxs("button",{type:"button",className:`date-header${c?" date-header--expanded":""}`,onClick:()=>ae(t),children:[i.jsxs("div",{className:"date-header__title",children:[i.jsx("span",{className:"date-label",children:qe(t)}),i.jsxs("span",{className:"date-summary",children:[s.length," activit",s.length===1?"y":"ies"," - ",fe(o)]})]}),i.jsx("span",{className:"date-header__icon",children:c?"âˆ’":"+"})]}),c?i.jsxs("table",{className:"activity-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{scope:"col",children:"Activity"}),i.jsx("th",{scope:"col",children:"Total Duration"}),i.jsx("th",{scope:"col",className:"actions-heading",children:"Actions"})]})}),i.jsx("tbody",{children:s.map(u=>{const v=(S==null?void 0:S.dateKey)===t&&S.originalLabel===u.label,j=r.currentLabel===u.label&&t===M;return i.jsxs("tr",{children:[i.jsx("td",{children:v?i.jsx("input",{type:"text",className:"duration-input",value:N,onChange:ye,placeholder:"Activity name"}):i.jsx("span",{children:u.label})}),i.jsx("td",{children:v?i.jsx("input",{type:"text",className:"duration-input",value:E,onChange:Ye,placeholder:"mm:ss or hh:mm:ss"}):i.jsx("span",{children:fe(u.totalMs)})}),i.jsx("td",{className:"actions-cell",children:i.jsx("div",{className:"action-buttons",children:v?i.jsxs(i.Fragment,{children:[i.jsx("button",{type:"button",className:"icon-button icon-button--primary",onClick:re,children:"Save"}),i.jsx("button",{type:"button",className:"icon-button",onClick:Ee,children:"Cancel"})]}):i.jsxs(i.Fragment,{children:[i.jsx("button",{type:"button",className:"icon-button",disabled:j,onClick:()=>Ie(t,u.label,u.totalMs),children:"Edit"}),i.jsx("button",{type:"button",className:"icon-button icon-button--danger",disabled:j,onClick:()=>_e(t,u.label),children:"Delete"})]})})})]},`${t}-${u.label}`)})})]}):null]},t)}),V?i.jsx("p",{className:"error-text",children:V}):null]})]})}K.TimesheetDevice=wt,Object.defineProperty(K,Symbol.toStringTag,{value:"Module"})});
