<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Activity Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0e1117;
      color: #fff;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      table-layout: fixed;
    }

    thead th {
      background: #1f2937;
      color: #fff;
      font-weight: bold;
      text-align: center;
      padding: 10px;
      position: sticky;
      top: 0;
      cursor: pointer;
      z-index: 2;
    }

    tbody td {
      text-align: center;
      padding: 8px;
      border-bottom: 1px solid #333;
    }

    tbody tr:hover {
      background: #2d3748;
    }

    .sort-asc::after {
      content: " ▲";
      font-size: 0.8em;
    }
    .sort-desc::after {
      content: " ▼";
      font-size: 0.8em;
    }

    .table-container {
      max-height: 80vh;
      overflow-y: auto;
      border: 1px solid #333;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h1>Activity Dashboard</h1>

  <div class="table-container">
    <table id="activityTable">
      <thead>
        <tr>
          <th data-col="0">Date</th>
          <th data-col="1">Steps</th>
          <th data-col="2">Active kcal</th>
          <th data-col="3">Total kcal</th>
          <th data-col="4"># Workouts</th>
          <th data-col="5">Minutes</th>
          <th data-col="6">Workout Names</th>
        </tr>
      </thead>
      <tbody id="activityBody">
        <!-- rows will be filled by script -->
      </tbody>
    </table>
  </div>

  <script>
    async function fetchData() {
      const res = await fetch("/data");
      const data = await res.json();
      const body = document.getElementById("activityBody");
      body.innerHTML = "";

      data.forEach(day => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${day.date}</td>
          <td>${day.steps}</td>
          <td>${day.activeKcal}</td>
          <td>${day.totalKcal}</td>
          <td>${day.workoutCount}</td>
          <td>${day.workoutMinutes.toFixed(1)}</td>
          <td>${(day.workoutNames || []).join(", ")}</td>
        `;
        body.appendChild(tr);
      });
    }

    // Sorting logic
    const table = document.getElementById("activityTable");
    const headers = table.querySelectorAll("th");
    let sortState = {};

    headers.forEach(header => {
      header.addEventListener("click", () => {
        const col = header.dataset.col;
        const tbody = table.querySelector("tbody");
        const rows = Array.from(tbody.querySelectorAll("tr"));
        const isNumeric = !isNaN(rows[0].children[col].innerText.trim());

        const currentState = sortState[col] || "desc";
        const newState = currentState === "asc" ? "desc" : "asc";
        sortState = {}; // reset others
        sortState[col] = newState;

        headers.forEach(h => h.classList.remove("sort-asc", "sort-desc"));
        header.classList.add(newState === "asc" ? "sort-asc" : "sort-desc");

        rows.sort((a, b) => {
          let A = a.children[col].innerText.trim();
          let B = b.children[col].innerText.trim();

          if (isNumeric) {
            A = parseFloat(A) || 0;
            B = parseFloat(B) || 0;
          }

          if (newState === "asc") {
            return A > B ? 1 : A < B ? -1 : 0;
          } else {
            return A < B ? 1 : A > B ? -1 : 0;
          }
        });

        tbody.innerHTML = "";
        rows.forEach(r => tbody.appendChild(r));
      });
    });

    fetchData();
  </script>
</body>
</html>